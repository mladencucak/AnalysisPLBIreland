<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Evaluation of Irish Rules model</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PLB DSS Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa fa fa-home"></span>
     
    About
  </a>
</li>
<li>
  <a href="Analysis1.html">
    <span class="fa fa fa fa-table"></span>
     
    Model Comparison
  </a>
</li>
<li>
  <a href="Analysis1.html">
    <span class="fa fa fa fa-table"></span>
     
    Model Evaluation
  </a>
</li>
<li>
  <a href="code.html">
    <span class="fa fa fa fa-file-code-o"></span>
     
    Codes
  </a>
</li>
<li>
  <a href="manuscript.html">
    <span class="fa fa fa fa-file-text-o"></span>
     
    Manuscript
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mladencucak/AnalysisPLBIreland">
    <span class="fa fa-github-square"></span>
     
    source
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Evaluation of Irish Rules model</h1>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<div id="libraries" class="section level2">
<h2>Libraries</h2>
<p>Packages needed for the analysis are loaded. If the libraries do not exist locally, they will be downloaded.</p>
<pre class="r"><code>list.of.packages &lt;-
  c(
    &quot;tidyverse&quot;,
    &quot;readxl&quot;,
    &quot;data.table&quot;,
    &quot;knitr&quot;,
    &quot;zoo&quot;,
    &quot;imputeTS&quot;,
    &quot;padr&quot;,
    &quot;devtools&quot;,
    &quot;pracma&quot;,
    &quot;remotes&quot;,
    &quot;parallel&quot;,
    &quot;pbapply&quot;,
    &quot;ggrepel&quot;,
    &quot;ggthemes&quot;,
    &quot;egg&quot;,
    &quot;rsm&quot;,
    &quot;GGally&quot;,
    &quot;R.utils&quot;,
    &quot;rcompanion&quot;,
    &quot;mgsub&quot;,
    &quot;here&quot;,
    &quot;stringr&quot;,
    &quot;pander&quot;
  )

new.packages &lt;-
  list.of.packages[!(list.of.packages %in% installed.packages()[, &quot;Package&quot;])]

#Download packages that are not already present
if (length(new.packages))
  install.packages(new.packages)

if (&quot;gt&quot; %in% installed.packages() == FALSE)
  remotes::install_github(&quot;rstudio/gt&quot;)

list.of.packages &lt;- c(list.of.packages, &quot;gt&quot;)
packages_load &lt;-
  lapply(list.of.packages, require, character.only = TRUE)

#Print warning if there is a problem with installing/loading some of packages
if (any(as.numeric(packages_load) == 0)) {
  warning(paste(&quot;Package/s&quot;, paste(list.of.packages[packages_load != TRUE]), &quot;not loaded!&quot;))
} else {
  print(&quot;All packages were successfully loaded.&quot;)
}</code></pre>
<pre><code>## [1] &quot;All packages were successfully loaded.&quot;</code></pre>
<pre class="r"><code>rm(list.of.packages, new.packages, packages_load)</code></pre>
</div>
<div id="reproducibility" class="section level2">
<h2>Reproducibility</h2>
<p>Outputs of computational exhaustive procedures have been stored with the data and can be loaded directly.</p>
</div>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<div id="weather-data" class="section level2">
<h2>Weather Data</h2>
<p>Historical weather data from Met Éireann synoptic weather station at Oak Park was used for model evaluation. The trial sites were in the radius of up to 500 m from the station in all years.</p>
<pre class="r"><code>#Weather data, parameters and cut off dates
load(file = here(&quot;data&quot;, &quot;op_2007_16&quot;, &quot;OP_2007-2016.RData&quot;))

OP[1:5, 1:20] %&gt;% gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#srvhxxfgtz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#srvhxxfgtz .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#srvhxxfgtz .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#srvhxxfgtz .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#srvhxxfgtz .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#srvhxxfgtz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#srvhxxfgtz .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#srvhxxfgtz .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#srvhxxfgtz .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#srvhxxfgtz .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#srvhxxfgtz .gt_striped {
  background-color: #f2f2f2;
}

#srvhxxfgtz .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#srvhxxfgtz .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#srvhxxfgtz .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#srvhxxfgtz .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#srvhxxfgtz .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#srvhxxfgtz .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#srvhxxfgtz .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#srvhxxfgtz .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#srvhxxfgtz .gt_center {
  text-align: center;
}

#srvhxxfgtz .gt_left {
  text-align: left;
}

#srvhxxfgtz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#srvhxxfgtz .gt_font_normal {
  font-weight: normal;
}

#srvhxxfgtz .gt_font_bold {
  font-weight: bold;
}

#srvhxxfgtz .gt_font_italic {
  font-style: italic;
}

#srvhxxfgtz .gt_super {
  font-size: 65%;
}

#srvhxxfgtz .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="srvhxxfgtz" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_left' rowspan='1' colspan='1'>date</th>
<th class='gt_col_heading gt_left' rowspan='1' colspan='1'>short_date</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>year</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>month</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>day</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>i_rain</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>rain</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>i_temp</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>temp</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>i_wetb</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>wetb</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>dewpt</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>vappr</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>i_rhum</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>rhum</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>msl</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>i_wdsp</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>wdsp</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>i_wddir</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>wddir</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_left'>2007-01-01 00:00:00</td>
<td class='gt_row gt_left'>2007-01-01</td>
<td class='gt_row gt_right'>2007</td>
<td class='gt_row gt_right'>1</td>
<td class='gt_row gt_right'>1</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>0.2</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>4.8</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>4.1</td>
<td class='gt_row gt_right'>3.0</td>
<td class='gt_row gt_right'>7.6</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>87</td>
<td class='gt_row gt_right'>1006.9</td>
<td class='gt_row gt_right'>2</td>
<td class='gt_row gt_right'>11</td>
<td class='gt_row gt_right'>2</td>
<td class='gt_row gt_right'>250</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>2007-01-01 01:00:00</td>
<td class='gt_row gt_left gt_striped'>2007-01-01</td>
<td class='gt_row gt_right gt_striped'>2007</td>
<td class='gt_row gt_right gt_striped'>1</td>
<td class='gt_row gt_right gt_striped'>1</td>
<td class='gt_row gt_right gt_striped'>0</td>
<td class='gt_row gt_right gt_striped'>0.0</td>
<td class='gt_row gt_right gt_striped'>0</td>
<td class='gt_row gt_right gt_striped'>5.4</td>
<td class='gt_row gt_right gt_striped'>0</td>
<td class='gt_row gt_right gt_striped'>4.4</td>
<td class='gt_row gt_right gt_striped'>3.0</td>
<td class='gt_row gt_right gt_striped'>7.6</td>
<td class='gt_row gt_right gt_striped'>0</td>
<td class='gt_row gt_right gt_striped'>84</td>
<td class='gt_row gt_right gt_striped'>1007.6</td>
<td class='gt_row gt_right gt_striped'>2</td>
<td class='gt_row gt_right gt_striped'>7</td>
<td class='gt_row gt_right gt_striped'>2</td>
<td class='gt_row gt_right gt_striped'>240</td>
</tr>
<tr>
<td class='gt_row gt_left'>2007-01-01 02:00:00</td>
<td class='gt_row gt_left'>2007-01-01</td>
<td class='gt_row gt_right'>2007</td>
<td class='gt_row gt_right'>1</td>
<td class='gt_row gt_right'>1</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>0.0</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>5.8</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>4.7</td>
<td class='gt_row gt_right'>3.2</td>
<td class='gt_row gt_right'>7.7</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>83</td>
<td class='gt_row gt_right'>1008.4</td>
<td class='gt_row gt_right'>2</td>
<td class='gt_row gt_right'>6</td>
<td class='gt_row gt_right'>2</td>
<td class='gt_row gt_right'>250</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>2007-01-01 03:00:00</td>
<td class='gt_row gt_left gt_striped'>2007-01-01</td>
<td class='gt_row gt_right gt_striped'>2007</td>
<td class='gt_row gt_right gt_striped'>1</td>
<td class='gt_row gt_right gt_striped'>1</td>
<td class='gt_row gt_right gt_striped'>0</td>
<td class='gt_row gt_right gt_striped'>0.1</td>
<td class='gt_row gt_right gt_striped'>0</td>
<td class='gt_row gt_right gt_striped'>5.2</td>
<td class='gt_row gt_right gt_striped'>0</td>
<td class='gt_row gt_right gt_striped'>4.3</td>
<td class='gt_row gt_right gt_striped'>2.8</td>
<td class='gt_row gt_right gt_striped'>7.5</td>
<td class='gt_row gt_right gt_striped'>0</td>
<td class='gt_row gt_right gt_striped'>84</td>
<td class='gt_row gt_right gt_striped'>1009.7</td>
<td class='gt_row gt_right gt_striped'>2</td>
<td class='gt_row gt_right gt_striped'>15</td>
<td class='gt_row gt_right gt_striped'>2</td>
<td class='gt_row gt_right gt_striped'>260</td>
</tr>
<tr>
<td class='gt_row gt_left'>2007-01-01 04:00:00</td>
<td class='gt_row gt_left'>2007-01-01</td>
<td class='gt_row gt_right'>2007</td>
<td class='gt_row gt_right'>1</td>
<td class='gt_row gt_right'>1</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>0.0</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>5.6</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>4.2</td>
<td class='gt_row gt_right'>2.3</td>
<td class='gt_row gt_right'>7.2</td>
<td class='gt_row gt_right'>0</td>
<td class='gt_row gt_right'>79</td>
<td class='gt_row gt_right'>1010.9</td>
<td class='gt_row gt_right'>2</td>
<td class='gt_row gt_right'>15</td>
<td class='gt_row gt_right'>2</td>
<td class='gt_row gt_right'>260</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<p>Additional variables needed for the analysis.</p>
<pre class="r"><code>colnames(OP)[which(names(OP) == &quot;year&quot;)] &lt;- &quot;year_var&quot;
OP &lt;-
  add_column(OP, week_var = data.table::week(OP$date), .before = &quot;i_rain&quot;)
OP &lt;-
  add_column(OP, doy = data.table::yday(OP$date), .before = &quot;i_rain&quot;)</code></pre>
<p>Subset the data to exclude the months of the year which we do not need for the analysis.</p>
<pre class="r"><code>OP &lt;- subset(OP, month &gt; 3 &amp; month &lt; 10)</code></pre>
<p>Remove the variables we don’t need for the analysis, to make some speed gains.</p>
<p>Get a summary of missing values for the variables of interest.</p>
<pre class="r"><code>OP %&gt;% group_by(year_var)  %&gt;%
  summarize(
    NA_rain = sum(is.na(rain)),
    NA_temp = sum(is.na(temp)),
    NA_rhum = sum(is.na(rhum))
  )</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["year_var"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["NA_rain"],"name":[2],"type":["int"],"align":["right"]},{"label":["NA_temp"],"name":[3],"type":["int"],"align":["right"]},{"label":["NA_rhum"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"2007","2":"0","3":"0","4":"0"},{"1":"2008","2":"0","3":"0","4":"0"},{"1":"2009","2":"6","3":"6","4":"6"},{"1":"2010","2":"0","3":"0","4":"0"},{"1":"2011","2":"0","3":"0","4":"0"},{"1":"2012","2":"0","3":"0","4":"0"},{"1":"2013","2":"0","3":"0","4":"0"},{"1":"2014","2":"0","3":"0","4":"1"},{"1":"2015","2":"0","3":"0","4":"0"},{"1":"2016","2":"0","3":"0","4":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Missing value imputation with qbic spline function works well up to 8 consecutive values, for variables that have some seasonal frequency, temperature and relative humidity in our case.</p>
<pre class="r"><code>infil_gap &lt;- 8 #Maximum length of the infill gap
OP$temp &lt;-
  round(na.spline(OP$temp, na.rm = FALSE, maxgap = infil_gap), 1)
OP$rhum &lt;-
  round(na.spline(OP$rhum, na.rm = FALSE, maxgap = infil_gap), 0)
OP$rhum  &lt;- sapply(OP$rhum, function(x)
  ifelse(x &gt; 100, x &lt;- 100, x))
#Check if the imputation worked
OP %&gt;% group_by(year_var)  %&gt;%
  summarize(
    NA_rain = sum(is.na(rain)),
    NA_temp = sum(is.na(temp)),
    NA_rhum = sum(is.na(rhum))
  )</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["year_var"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["NA_rain"],"name":[2],"type":["int"],"align":["right"]},{"label":["NA_temp"],"name":[3],"type":["int"],"align":["right"]},{"label":["NA_rhum"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"2007","2":"0","3":"0","4":"0"},{"1":"2008","2":"0","3":"0","4":"0"},{"1":"2009","2":"6","3":"0","4":"0"},{"1":"2010","2":"0","3":"0","4":"0"},{"1":"2011","2":"0","3":"0","4":"0"},{"1":"2012","2":"0","3":"0","4":"0"},{"1":"2013","2":"0","3":"0","4":"0"},{"1":"2014","2":"0","3":"0","4":"0"},{"1":"2015","2":"0","3":"0","4":"0"},{"1":"2016","2":"0","3":"0","4":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Rain is somewhat harder to impute but there are ways around this problem, especially when there are only a few values missing. Since rain data is required only in certain rare situations for the model to run, defined within the model, we can use the same conditions to impute missing values outside of that range. We are certain that rain is irrelevant if relative humidity is below 88 % and temperature of 8 C, and these values can then be replaced with 0. Tis way we will know if rain data is missing in areas of interest.</p>
<pre class="r"><code>OP[is.na(OP$rain), ]$rain &lt;-
  with(OP[is.na(OP$rain), ], ifelse(rhum &lt; 88 | temp &lt; 8, 0, rain))
OP %&gt;% group_by(year_var)  %&gt;%
  summarize(
    NA_rain = sum(is.na(rain)),
    NA_temp = sum(is.na(temp)),
    NA_rhum = sum(is.na(rhum))
  )</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["year_var"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["NA_rain"],"name":[2],"type":["int"],"align":["right"]},{"label":["NA_temp"],"name":[3],"type":["int"],"align":["right"]},{"label":["NA_rhum"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"2007","2":"0","3":"0","4":"0"},{"1":"2008","2":"0","3":"0","4":"0"},{"1":"2009","2":"0","3":"0","4":"0"},{"1":"2010","2":"0","3":"0","4":"0"},{"1":"2011","2":"0","3":"0","4":"0"},{"1":"2012","2":"0","3":"0","4":"0"},{"1":"2013","2":"0","3":"0","4":"0"},{"1":"2014","2":"0","3":"0","4":"0"},{"1":"2015","2":"0","3":"0","4":"0"},{"1":"2016","2":"0","3":"0","4":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>We have no missing values and it is safe to proceed.</p>
</div>
<div id="bio-data" class="section level2">
<h2>Bio data</h2>
<p>Planting date and first observation of the disease are loaded. Emergence takes up to 3 weeks under Irish conditions. Period when healthy host present from emergence until 14 days prior to a first observation of the disease in the field. Warning period 10-day ‘warning period’ considered to last from -14 days to – 4 days prior to disease observed in the field. The 4-day period was assumed to be a minimum time needed from incubation period, for establishment of visible disease symptoms in the field.</p>
<pre class="r"><code>#Get subsets of data for period before the epidemics were initiated
dates_cut &lt;-
  read_csv(
    here(&quot;data&quot;, &quot;op_2007_16&quot;, &quot;plantingdates.csv&quot;),
    col_types = cols(
      disease_observed = col_date(format = &quot;%d/%m/%Y&quot;),
      last_assessment = col_date(format = &quot;%d/%m/%Y&quot;)
    )
  )
dates_cut$planting_date &lt;-
  as.Date(dates_cut$planting_date, format = &quot;%d/%m/%Y&quot;)
dates_cut$emergence &lt;- as.Date(dates_cut$planting_date) + 21
#st warnning period to 14 days before disease onset
dates_cut &lt;- add_column(dates_cut, disease_onset = as.Date(dates_cut$disease_observed) - 4,
                        .before = &quot;disease_observed&quot;)

dates_cut &lt;- add_column(dates_cut, warning = as.Date(dates_cut$disease_onset) - 10, .before = &quot;disease_onset&quot; )
rownames(dates_cut) &lt;- NULL

dates_cut %&gt;% rename_all(. %&gt;% capitalize() %&gt;% gsub(&quot;_&quot;, &quot; &quot;, .))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Planting date"],"name":[2],"type":["date"],"align":["right"]},{"label":["Emergence"],"name":[3],"type":["date"],"align":["right"]},{"label":["Warning"],"name":[4],"type":["date"],"align":["right"]},{"label":["Disease onset"],"name":[5],"type":["date"],"align":["right"]},{"label":["Disease observed"],"name":[6],"type":["date"],"align":["right"]},{"label":["Last assessment"],"name":[7],"type":["date"],"align":["right"]}],"data":[{"1":"2007","2":"2007-04-03","3":"2007-04-24","4":"2007-06-16","5":"2007-06-26","6":"2007-06-30","7":"2007-08-23"},{"1":"2008","2":"2008-04-07","3":"2008-04-28","4":"2008-06-18","5":"2008-06-28","6":"2008-07-02","7":"2008-08-13"},{"1":"2009","2":"2009-04-21","3":"2009-05-12","4":"2009-06-22","5":"2009-07-02","6":"2009-07-06","7":"2009-08-08"},{"1":"2010","2":"2010-05-04","3":"2010-05-25","4":"2010-07-05","5":"2010-07-15","6":"2010-07-19","7":"2010-08-30"},{"1":"2011","2":"2011-05-06","3":"2011-05-27","4":"2011-07-14","5":"2011-07-24","6":"2011-07-28","7":"2011-08-25"},{"1":"2012","2":"2012-05-28","3":"2012-06-18","4":"2012-06-29","5":"2012-07-09","6":"2012-07-13","7":"2012-08-28"},{"1":"2013","2":"2013-06-03","3":"2013-06-24","4":"2013-08-09","5":"2013-08-19","6":"2013-08-23","7":"2013-09-20"},{"1":"2014","2":"2014-05-23","3":"2014-06-13","4":"2014-07-18","5":"2014-07-28","6":"2014-08-01","7":"2014-09-11"},{"1":"2015","2":"2015-05-22","3":"2015-06-12","4":"2015-07-17","5":"2015-07-27","6":"2015-07-31","7":"2015-09-18"},{"1":"2016","2":"2016-05-31","3":"2016-06-21","4":"2016-07-08","5":"2016-07-18","6":"2016-07-22","7":"2016-09-16"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="the-model" class="section level2">
<h2>The Model</h2>
<p>Implementation of the model</p>
<pre class="r"><code>IrishRulesModel &lt;- function(weather,
                            param = NULL,
                            infill_gap = NULL) {

  # wetness requirement prior to infection accumulation start
  # time window of 6 hours, 3 before/after sporulation ends
  wet_before &lt;- 3
  wet_after &lt;- 3
  
  # Parameter list
  if (is.null(param)) {
    rh_thresh &lt;- 90
    temp_thresh &lt;- 10
    hours &lt;- 12   #sum of hours before EBH accumulation
  } else {
    #pass a vector of parameters
    rh_thresh &lt;- as.numeric(param[2])
    temp_thresh &lt;- as.numeric(param[3])
    hours &lt;- as.numeric(param[4])
    lw_rhum &lt;-
      param[5]           #if is NA then only rain data will be used
  }
  
  #threshold for estimation of leaf wetness using relative humidity
  lw_rhum_threshold &lt;- 90
    
  weather[[&quot;rain&quot;]] -&gt; rain
  if (&quot;rhum&quot; %in% names(weather)) {
    weather[[&quot;rhum&quot;]] -&gt; rh
  }
  if (&quot;rh&quot; %in% names(weather)) {
    weather[[&quot;rh&quot;]] -&gt; rh
  }
  weather[[&quot;temp&quot;]] -&gt; temp
  
  # This function to infil missing values to let the model run
  #If maximum infill gap is not provided it is defaulted to 7
  if (is.null(infill_gap)) {
    infill_gap &lt;- 7
  }
  
  if (sum(is.na(with(weather, rain, temp, rhum))) &gt; 0) {
    temp &lt;-
      round(zoo::na.spline(temp, na.rm = FALSE, maxgap = infill_gap), 1)
    rh &lt;-
      round(zoo::na.spline(rh, na.rm = FALSE, maxgap = infill_gap), 0)
    rh  &lt;- sapply(rh, function(x) ifelse(x &gt; 100, x &lt;- 100, x))
  }
  
  if (sum(is.na(with(weather, rain, temp, rhum))) &gt; 0) {
    stop(print(&quot;The sum of NAs is more than 7! Check your weather data.&quot;))
  }
  
  #&quot;Out of boounds&quot;
  rain &lt;- c(rain, rep(0, 20))
  temp &lt;- c(temp, rep(0, 20))
  rh &lt;- c(rh, rep(0, 20))
  
  # conditions for sporulation
  criteria &lt;- as.numeric(temp &gt;= temp_thresh &amp; rh &gt;= rh_thresh)
  
  #cumulative sum of hours that meet the criteria for sporulatoion with restart at zero
  criteria_sum &lt;-
    stats::ave(criteria, cumsum(criteria == 0), FUN = cumsum)
  
  #Initiate risk accumulation vector
  risk &lt;- rep(0, length(temp))
  
  criteria_met12  &lt;-
    as.numeric(criteria_sum &gt;= hours) #accumulation of EBH starts after sporulation
  idx             &lt;- which(criteria_sum == hours)
  
  
  #If there are no accumulations return vector with zeros
  if (sum(criteria_sum == hours) == 0) {
    #breaks the loop if there is no initial accumulation of 12 hours
    head(risk, -20)
  } else{
    for (j in 1:length(idx)) {
      #switch that looks if there was wetness: first rain, then both rain and rh, if rh exists
      if (if (lw_rhum==&quot;rain&quot;) {
        #if only rain
        (sum(rain[(idx[j] - wet_before):(idx[j] + wet_after)]) &gt;= 0.1)           #just see rain sum
      } else{
        any((any(rh[(idx[j] - wet_before):(idx[j] + wet_after)] &gt;= lw_rhum_threshold)) |
            #take both as possible switches
            (sum(rain[(idx[j] - wet_before):(idx[j] + wet_after)]) &gt;= 0.1))
      })
        # outputs true or false
      {
        n &lt;- idx[j]        #start accumulation from 12th hour
      } else {
        n &lt;- idx[j] + 4      #start accumulation from 16th hour
      }
      s &lt;- criteria_met12[n]
      # if a break of less than or equal to 5 hours
      m &lt;- n - 1
      
      while (s == 1)
      {
        risk[n] &lt;- risk[m] + 1
        n &lt;- n + 1
        
        m &lt;- n - 1
        
        s &lt;- criteria[n]
        if (s == 0 &amp;&amp; (criteria[n + 2] == 1)) {
          n = n + 2
          
          s = 1
          
        } else if (s == 0 &amp;&amp; (criteria[n + 3] == 1)) {
          n = n + 3
          
          s = 1
          
        } else if (s == 0 &amp;&amp; (criteria[n + 4] == 1)) {
          n = n + 4
          
          s = 1
          
        } else if (s == 0 &amp;&amp; (criteria[n + 5] == 1)) {
          n = n + 5
          
          s = 1
          
        }
      }
      
    }
    head(risk, -20) #remove last 20 values that were added to vectors to prevent &quot;Out of bounds&quot; issue
    
  }
  
}</code></pre>
</div>
</div>
<div id="the-analysis" class="section level1">
<h1>The Analysis</h1>
<p>The set of the most important variables of Irish rules model is evaluated. The Excel sheet with parameters under evaluation is available in data folder and can be changed and used for model evaluation in other locations. Column named <code>90_10_12_rain</code> represents set of the original model parameters.</p>
<pre class="r"><code>#read in parameters
parameters &lt;-
  read_excel(here(&quot;data&quot;, &quot;op_2007_16&quot;, &quot;par.xlsx&quot;), sheet = &quot;par&quot;)
parameters %&gt;% kable() %&gt;% kableExtra::kable_styling(latex_options = &quot;striped&quot;,full_width = FALSE)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">rh_thresh</th>
<th align="right">temp_thresh</th>
<th align="right">hours</th>
<th align="left">lw_rh</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">93</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="left">rain</td>
</tr>
<tr class="even">
<td align="right">92</td>
<td align="right">12</td>
<td align="right">14</td>
<td align="left">rainrh</td>
</tr>
<tr class="odd">
<td align="right">91</td>
<td align="right">11</td>
<td align="right">13</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">90</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">89</td>
<td align="right">9</td>
<td align="right">11</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">88</td>
<td align="right">8</td>
<td align="right">10</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="right">7</td>
<td align="right">9</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>params &lt;- expand.grid(parameters[, 1:3])

#set the leaf wetness threshold to NA, meaning only rain is considered as an estimator for leaf wetness, as in original model
params$lw_rh &lt;- &quot;rain&quot;

#Repeat all of the analysis considering rh &gt;= 90% and rain as an estimator of leaf wetness
params2 &lt;- params
params2$lw_rh &lt;- as.character(&quot;rainrh&quot;)

parameters &lt;- bind_rows(params, params2)
rm(params, params2)

# set a column with a name for each model
parameters &lt;- add_column(parameters, model = NA, .before = 1)
for (i in seq_along(1:nrow(parameters))) {
  parameters[i, 1] &lt;-
    paste0(parameters[i, 2:length(names(parameters))], collapse = &quot;_&quot;)
}
str(parameters)</code></pre>
<pre><code>## &#39;data.frame&#39;:    686 obs. of  5 variables:
##  $ model      : chr  &quot;93_13_15_rain&quot; &quot;92_13_15_rain&quot; &quot;91_13_15_rain&quot; &quot;90_13_15_rain&quot; ...
##  $ rh_thresh  : num  93 92 91 90 89 88 87 93 92 91 ...
##  $ temp_thresh: num  13 13 13 13 13 13 13 12 12 12 ...
##  $ hours      : num  15 15 15 15 15 15 15 15 15 15 ...
##  $ lw_rh      : chr  &quot;rain&quot; &quot;rain&quot; &quot;rain&quot; &quot;rain&quot; ...</code></pre>
<div id="model-run" class="section level2">
<h2>Model Run</h2>
<p>The model has been run with each set of parameters, and columns with model outputs are attached to weather data frame. Names of new columns correspond to the set of parameters supplied.</p>
<pre class="r"><code># This chunk is not run
for(i in 1:nrow(parameters)) {
  loop_var &lt;- apply(parameters[i, ], 1, function(x) {
    #run the model with different parameters
    k &lt;-
      lapply(split(OP, factor(OP$year)), function(chunk)
        IrishRulesModel(chunk, x)) #get the list of outputs
    unlist(k) -&gt; k  #make it a vector
  })
  OP[, ncol(OP) + 1] &lt;-  as.numeric(loop_var)
  rm(loop_var)
  names(OP)[ncol(OP)] &lt;- paste0(parameters[i, 1])
  print(paste(i, &quot;of&quot;, nrow(parameters)))
}


nn &lt;- paste0(names(OP[, 26:length(names(OP))]), &quot;_ebh&quot;, &quot;&quot;)
setnames(OP, old = c(names(OP[, 26:length(names(OP))])), new = nn)
rm( nn)</code></pre>
<p>Instead, just load the output from a prior model run to save time.</p>
<pre class="r"><code>load(file = here(&quot;data&quot;, &quot;op_2007_16&quot;, &quot;OP_for_analysis.RData&quot;))
# Sample of outputs
head(OP[, c(1, 7, 9, 15, 24:30)], 5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["date"],"name":[1],"type":["S3: POSIXct"],"align":["right"]},{"label":["doy"],"name":[2],"type":["int"],"align":["right"]},{"label":["rain"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["vappr"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["stna"],"name":[5],"type":["fctr"],"align":["left"]},{"label":["sol_rad"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["93_13_15_rain_ebh"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["92_13_15_rain_ebh"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["91_13_15_rain_ebh"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["90_13_15_rain_ebh"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["89_13_15_rain_ebh"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"2007-04-01 00:00:00","2":"91","3":"0","4":"8.0","5":"Oak_Park","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","_rn_":"2401162"},{"1":"2007-04-01 01:00:00","2":"91","3":"0","4":"7.9","5":"Oak_Park","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","_rn_":"2401163"},{"1":"2007-04-01 02:00:00","2":"91","3":"0","4":"7.9","5":"Oak_Park","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","_rn_":"2401164"},{"1":"2007-04-01 03:00:00","2":"91","3":"0","4":"7.6","5":"Oak_Park","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","_rn_":"2401165"},{"1":"2007-04-01 04:00:00","2":"91","3":"0","4":"7.2","5":"Oak_Park","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","_rn_":"2401166"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="evaluation-procedure" class="section level2">
<h2>Evaluation procedure</h2>
<p>The function <code>SensParametersCalc</code> calculates Sensitivity and Specificity of each variation of the model.</p>
<pre class="r"><code>SensParametersCalc &lt;-
  function(y,
           weather_data,
           dates_cut,
           prot_duration = NULL) {
    #Set the warning threshold and run the rest of the script
    warning_threshold &lt;- y
    #data
    fun_df &lt;- weather_data
    
    #A function to subset the data for the period of interest in each year
    test.overlap = function(vals, start_date, end_date) {
      rowSums(mapply(function(a, b)
        between(vals, a, b),
        start_date, end_date)) &gt; 0
    }
    
    #Subset  each year from emergence to disease onset and calculate number of FP and TN
    fptn_df &lt;-
      fun_df  %&gt;%
      #Subset the of the data for the duration of non-warning period for each year
      filter(test.overlap(short_date, dates_cut$emergence, dates_cut$warning)) %&gt;%
      select(
        ends_with(&quot;year_var&quot;),
        ends_with(&quot;week_var&quot;),
        ends_with(&quot;doy&quot;),
        ends_with(&quot;_ebh&quot;)
      ) %&gt;%
      group_by(year_var) %&gt;%
      #if there was an accumulation from previous day, it would triger a warning
      #Check all of the first five rows because of possible break of 5 hours
      mutate_at(., .vars = colnames(.[grep(&quot;ebh&quot;, colnames(.))]),
                funs(
                  ifelse(row_number() &lt;= 5 &amp; . &gt;= warning_threshold,
                         warning_threshold, .)
                )) %&gt;%
      #all five values all changed so we have to delete 4 of them and leave only 1
      mutate_at(., .vars = colnames(.[grep(&quot;ebh&quot;, colnames(.))]),
                funs(ifelse(
                  row_number() &lt;= 4 &amp; . == warning_threshold, 0, .
                ))) %&gt;%
      # Change values coresponding to the warning threshold to 1 for calculating the sum
      mutate_at(., .vars = colnames(.[grep(&quot;ebh&quot;, colnames(.))]),
                funs(ifelse(. == warning_threshold, 1, 0))) %&gt;%
      group_by(year_var, week_var, doy) %&gt;%
      summarise_at(., .vars = colnames(.[grep(&quot;ebh&quot;, colnames(.))]), .funs = sum)
    
    
    #Each warning would cause treatment that will keep the plants protected for a period of time
    prot_duration &lt;-
      ifelse(is.null(prot_duration), 7, prot_duration)#If not defined default value is 7 days
    
    TreatmentWindow &lt;- function(x, prot_duration) {
      # don&#39;t leave commented code. Use or remove
      # x &lt;- fptn_df[[&quot;93_10_12_rain_ebh&quot;]]
      y &lt;-
        vector(mode = &quot;numeric&quot;, length = length(x) + prot_duration)
      for (i in seq_along(x)) {
        if (x[i] == 1) {
          y[i:c(i + prot_duration)] &lt;- 1
        }
      }
      y
    }
    fptn_df[grep(&quot;ebh&quot;, colnames(fptn_df))] &lt;-
      lapply(fptn_df[grep(&quot;ebh&quot;, colnames(fptn_df))], function(x)
        TreatmentWindow(x, prot_duration))
    
    
    FP &lt;-
      summarise_all(fptn_df[, colnames(fptn_df[, grep(&quot;ebh&quot;, colnames(fptn_df))])], .funs = sum)
    
    #Each warning will cause a treatment
    total_days &lt;-
      nrow(fptn_df) #total  duration of non_warning period
    
    TN &lt;- total_days - FP
    
    
    ##########################################################
    #subset for 10 days prior to disease onset: Warning period
    tpfn_df &lt;-
      fun_df %&gt;%
      #Subset of the data for the duration WARNING period in each year
      filter(test.overlap(short_date,  dates_cut$warning, dates_cut$disease_onset)) %&gt;%
      select(
        ends_with(&quot;year_var&quot;),
        ends_with(&quot;week_var&quot;),
        ends_with(&quot;doy&quot;),
        ends_with(&quot;_ebh&quot;)
      ) %&gt;%
      mutate_at(., .vars = colnames(.[grep(&quot;ebh&quot;, colnames(.))]),
                funs(
                  ifelse(row_number() &lt;= 5 &amp;
                           . &gt;= warning_threshold, warning_threshold, .)
                )) %&gt;%
      #all five values is changed so we have to delete 4 of them and leave only one
      mutate_at(., .vars = colnames(.[grep(&quot;ebh&quot;, colnames(.))]),
                funs(ifelse(
                  row_number() &lt;= 4 &amp; . == warning_threshold,
                  0, .
                ))) %&gt;%
      mutate_at(., .vars = colnames(.[grep(&quot;ebh&quot;, colnames(.))]),
                funs(ifelse(. == warning_threshold, 1, 0))) %&gt;%
      group_by(year_var) %&gt;%
      summarise_at(., .vars = colnames(.[, c(4:length(colnames(.)))]) , .funs = sum)  %&gt;%
      mutate_at(., #some years have two warnings during the warning period
                .vars = colnames(.[grep(&quot;ebh&quot;, colnames(.))]), funs(ifelse(. &gt;= 1 , 1, 0)))
    
    # tpfn_df[,1:4]
    
    TP &lt;-
      summarise_all(tpfn_df[, colnames(tpfn_df[, grep(&quot;ebh&quot;, colnames(tpfn_df))])], .funs = sum)
    
    #number of outbreaks(in this case there is only one location, so number of outbreaks is same as number of years.
    unique(tpfn_df$year_var) %&gt;%
      length() -&gt; no_of_outbreaks
    FN &lt;- no_of_outbreaks - TP
    
    #summary
    test &lt;- data.frame(
      model = names(FP),
      FP = t(FP[1,]),
      tn = t(TN[1,]),
      TP = t(TP[1,]),
      FN = t(FN[1,])
    )
    names(test) &lt;- c(&quot;model&quot;, &quot;FP&quot;, &quot;TN&quot;, &quot;TP&quot;, &quot;FN&quot;)
    test &lt;- data.frame(test, row.names = NULL)
    
    
    test$model &lt;-  str_replace(test$model, &quot;_ebh&quot;, &quot;&quot;)
    test$sens &lt;- with(test, TP / (TP + FN))  #PTP sensitivity
    test$spec &lt;- with(test, TN / (TN + FP))  #PTN specificity
    return_df &lt;- test[, c(&quot;model&quot;, &quot;sens&quot;)]
    return_df$&quot;one_min_spec&quot; &lt;- 1 - test[, &quot;spec&quot;]
    return_df$cut_point &lt;- warning_threshold
    
    return(return_df)
  }</code></pre>
<p>This function was applied to output of each variation of the model with varying warning threshold from 1 to 18 EBH. The function is run with parallel processing support because it reduces the run time to 4 minutes with 4 cores i7(7th generation) and 12GB RAM laptop.</p>
<pre class="r"><code># this chunk not evaluated
#select max warning threshold
warning_thresholds &lt;- 1:18
begin &lt;- Sys.time()
#Detect the number of cores and set it to total minus 1, if there are multiple cores, to avoid overload
cores &lt;- ifelse(detectCores() &gt; 1, detectCores()-1, 1) 
cl &lt;- makeCluster(cores)
clusterExport(cl, c(&quot;OP&quot;, &quot;dates_cut&quot;, &quot;SensParametersCalc&quot;))
clusterEvalQ(cl, library(&quot;tidyverse&quot;))
  ROC &lt;- pbapply::pblapply(warning_thresholds, function(x)
  {
    xx &lt;- SensParametersCalc(x,OP, dates_cut, prot_duration = 7)
    return(xx)
  },
  cl = cl
  )
begin- Sys.time() #check the duration of the process in the console
stopCluster(cl)</code></pre>
<p>Rather, the results of calculations from a prior run can be directly loaded.</p>
<pre class="r"><code>load(file = here(&quot;data&quot;, &quot;op_2007_16&quot;,&quot;results&quot;,&quot;ROC_output.Rdata&quot;))</code></pre>
<p>Sort the outputs for each model variation.</p>
<pre class="r"><code>ROC_data &lt;-
  as.data.frame(data.table::rbindlist(ROC))
rownames(ROC_data) &lt;- NULL
# rm(ROC) #Outputs stored for each warning threshold/cutoffs
ROC_data &lt;-
  base::split(ROC_data, ROC_data$model) #Get the list of all model outputs with different cutoffs
ROC_data[[1]] %&gt;% gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#btdpwxikbu .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#btdpwxikbu .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#btdpwxikbu .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#btdpwxikbu .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#btdpwxikbu .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#btdpwxikbu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#btdpwxikbu .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#btdpwxikbu .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#btdpwxikbu .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#btdpwxikbu .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#btdpwxikbu .gt_striped {
  background-color: #f2f2f2;
}

#btdpwxikbu .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#btdpwxikbu .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#btdpwxikbu .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#btdpwxikbu .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#btdpwxikbu .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#btdpwxikbu .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#btdpwxikbu .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#btdpwxikbu .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#btdpwxikbu .gt_center {
  text-align: center;
}

#btdpwxikbu .gt_left {
  text-align: left;
}

#btdpwxikbu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#btdpwxikbu .gt_font_normal {
  font-weight: normal;
}

#btdpwxikbu .gt_font_bold {
  font-weight: bold;
}

#btdpwxikbu .gt_font_italic {
  font-style: italic;
}

#btdpwxikbu .gt_super {
  font-size: 65%;
}

#btdpwxikbu .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="btdpwxikbu" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_left' rowspan='1' colspan='1'>model</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>sens</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>one_min_spec</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>cut_point</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_left'>87_10_10_rain</td>
<td class='gt_row gt_right'>1.0</td>
<td class='gt_row gt_right'>0.6443299</td>
<td class='gt_row gt_right'>1</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>87_10_10_rain</td>
<td class='gt_row gt_right gt_striped'>1.0</td>
<td class='gt_row gt_right gt_striped'>0.6005155</td>
<td class='gt_row gt_right gt_striped'>2</td>
</tr>
<tr>
<td class='gt_row gt_left'>87_10_10_rain</td>
<td class='gt_row gt_right'>1.0</td>
<td class='gt_row gt_right'>0.5773196</td>
<td class='gt_row gt_right'>3</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>87_10_10_rain</td>
<td class='gt_row gt_right gt_striped'>1.0</td>
<td class='gt_row gt_right gt_striped'>0.4484536</td>
<td class='gt_row gt_right gt_striped'>4</td>
</tr>
<tr>
<td class='gt_row gt_left'>87_10_10_rain</td>
<td class='gt_row gt_right'>0.8</td>
<td class='gt_row gt_right'>0.4201031</td>
<td class='gt_row gt_right'>5</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>87_10_10_rain</td>
<td class='gt_row gt_right gt_striped'>0.8</td>
<td class='gt_row gt_right gt_striped'>0.3891753</td>
<td class='gt_row gt_right gt_striped'>6</td>
</tr>
<tr>
<td class='gt_row gt_left'>87_10_10_rain</td>
<td class='gt_row gt_right'>0.8</td>
<td class='gt_row gt_right'>0.3685567</td>
<td class='gt_row gt_right'>7</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>87_10_10_rain</td>
<td class='gt_row gt_right gt_striped'>0.8</td>
<td class='gt_row gt_right gt_striped'>0.3556701</td>
<td class='gt_row gt_right gt_striped'>8</td>
</tr>
<tr>
<td class='gt_row gt_left'>87_10_10_rain</td>
<td class='gt_row gt_right'>0.8</td>
<td class='gt_row gt_right'>0.3376289</td>
<td class='gt_row gt_right'>9</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>87_10_10_rain</td>
<td class='gt_row gt_right gt_striped'>0.8</td>
<td class='gt_row gt_right gt_striped'>0.3247423</td>
<td class='gt_row gt_right gt_striped'>10</td>
</tr>
<tr>
<td class='gt_row gt_left'>87_10_10_rain</td>
<td class='gt_row gt_right'>0.8</td>
<td class='gt_row gt_right'>0.3247423</td>
<td class='gt_row gt_right'>11</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>87_10_10_rain</td>
<td class='gt_row gt_right gt_striped'>0.8</td>
<td class='gt_row gt_right gt_striped'>0.3015464</td>
<td class='gt_row gt_right gt_striped'>12</td>
</tr>
<tr>
<td class='gt_row gt_left'>87_10_10_rain</td>
<td class='gt_row gt_right'>0.8</td>
<td class='gt_row gt_right'>0.2835052</td>
<td class='gt_row gt_right'>13</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>87_10_10_rain</td>
<td class='gt_row gt_right gt_striped'>0.8</td>
<td class='gt_row gt_right gt_striped'>0.2628866</td>
<td class='gt_row gt_right gt_striped'>14</td>
</tr>
<tr>
<td class='gt_row gt_left'>87_10_10_rain</td>
<td class='gt_row gt_right'>0.8</td>
<td class='gt_row gt_right'>0.2525773</td>
<td class='gt_row gt_right'>15</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>87_10_10_rain</td>
<td class='gt_row gt_right gt_striped'>0.8</td>
<td class='gt_row gt_right gt_striped'>0.2319588</td>
<td class='gt_row gt_right gt_striped'>16</td>
</tr>
<tr>
<td class='gt_row gt_left'>87_10_10_rain</td>
<td class='gt_row gt_right'>0.7</td>
<td class='gt_row gt_right'>0.2113402</td>
<td class='gt_row gt_right'>17</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>87_10_10_rain</td>
<td class='gt_row gt_right gt_striped'>0.6</td>
<td class='gt_row gt_right gt_striped'>0.2113402</td>
<td class='gt_row gt_right gt_striped'>18</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
</div>
<div id="roc" class="section level2">
<h2>ROC</h2>
<p>Contingency tables were created with sensitivity and specificity values from confusion matrix for each decision threshold for all model outputs from 1 to 18 EBH accumulation. Area under the curve (AUROC) was calculated using trapezoidal rule for each variation of the model outputs.</p>
<pre class="r"><code>#function to calculate AUROC for list of inputs
GetAUC &lt;- function(fun_df) {
  fun_df &lt;- fun_df[rev(order(fun_df$cut_point)), ]
  auc &lt;-
    pracma::trapz(c(0, fun_df$one_min_spec, 1), c(0, fun_df$sens, 1))
  result &lt;- data.frame(model = unique(fun_df$model),
                       auc = auc)
  return(result)
}
AUROC_data &lt;- lapply(ROC_data, function(x)
  GetAUC(x))
AUROC_data &lt;-
  lapply(AUROC_data, function(x)
    mutate_if(x, is.factor, as.character))
AUROC_data &lt;- bind_rows(AUROC_data)</code></pre>
<p>Empirical ROC curve was created for each variation of the model.</p>
<pre class="r"><code>PlotROC &lt;- function(df, numbering = NULL) {
  df &lt;- df[rev(df$cut_point), ]
#append rows for plotting
x &lt;- rep(NA, ncol(df))
df &lt;- rbind(x, df)
df[nrow(df) + 1, ] &lt;- NA
df$model &lt;- unique(df$model[!is.na(df$model)])
df[1, c(&quot;sens&quot;, &quot;one_min_spec&quot;)] &lt;- 0
df[nrow(df), c(&quot;sens&quot;, &quot;one_min_spec&quot;)] &lt;- 1

#Condense labels for a single cutoff point
 df &lt;- 
  df %&gt;% 
  group_by(one_min_spec, sens, model) %&gt;% 
  summarise(cut_point = ifelse(all(is.na(cut_point)),
                               &quot;&quot;,
                               range(cut_point, na.rm = TRUE) %&gt;%
                                 unique() %&gt;%
                                 paste(collapse = &quot;-&quot;))) %&gt;%
  ungroup()


#find AUROC value for selected model
if(&quot;model&quot;%in% names(AUROC_data)){
  AUROC_lab &lt;- paste(&quot;AUROC =&quot;, round(AUROC_data[AUROC_data$model == unique(df$model), ]$auc, 3))
} else { #some changes in next chnk of code made this necessary, col model will be split and removed
  if(str_split(unique(df$model), &quot;_&quot;)[[1]][4] == &quot;rainrh&quot;){
    mod_var &lt;- str_split(unique(df$model), &quot;_&quot;)
    mod_var[[1]][4] &lt;- &quot;rainrh&quot;
    implode &lt;- function(..., sep=&#39;&#39;) {paste(..., collapse=sep)}
    mod_var &lt;-  implode(mod_var[[1]],sep=&quot;_&quot;)   
  }else{
    mod_var &lt;- str_split(unique(df$model), &quot;_&quot;)
    implode &lt;- function(..., sep=&#39;&#39;) {paste(..., collapse=sep)}
    mod_var &lt;-  implode(mod_var[[1]],sep=&quot;_&quot;) 
  }
  auc_val &lt;- 
    unite(AUROC_data, col = model,  colnames(AUROC_data[,1:4]), sep = &quot;_&quot;) %&gt;% 
    filter(model == mod_var) %&gt;% 
    select(auc)
  AUROC_lab &lt;- paste(&quot;AUROC =&quot;, round(auc_val, 3))
  
}

#Print title without or with lettering (for later analysis)
pars &lt;- str_split(df[1,&quot;model&quot;], &quot;_&quot;)
title &lt;- 
  paste0( ifelse(is.null(numbering),&quot;&quot;,  paste0(letters[numbering],&quot;) &quot;)), 
          &quot;ROC for &quot;, 
          &quot;Tt = &quot;, pars[[1]][[2]],&quot;°C; &quot;,
          &quot;RHt = &quot;, pars[[1]][1], &quot;%; &quot;,
          &quot;SDt = &quot;, pars[[1]][3], 
          &quot;\n&quot;,
          &quot; hours; and LW = rain &gt; 0.1mm and RH&gt;90%.&quot;)


ggplot(df, aes(one_min_spec, sens, label = cut_point)) +
  geom_abline(
    intercept = 0,
    slope = 1,
    color = &quot;black&quot;,
    linetype = &quot;dashed&quot;
  ) +
  geom_path(colour = &quot;gray&quot;) +
  geom_point(colour = &quot;black&quot;) +
  geom_text_repel(size = 3) +
  scale_y_continuous(limits = c(0, 1),
                     expand = c(0, 0),
                     breaks = c(0, 0.1, 0.25, 0.5, 0.75, 0.9, 1),
                     name = &quot;Sensitivity&quot;) +
  scale_x_continuous(limits = c(0, 1),
                     expand = c(0, 0),
                     breaks = c(0, 0.1, 0.25, 0.5, 0.75, 0.9, 1),
                     name = &quot;1- Specificity&quot;) +
  ggtitle(title) +
  annotate(
    &quot;text&quot;,
    x = 0.7,
    y = 0.15,
    label = AUROC_lab,
    size = 5
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 10.5),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )
}
PlotROC(ROC_data[[&quot;90_10_12_rain&quot;]])</code></pre>
<p><img src="images/plotROC-1.png" width="80%" height="80%" style="display: block; margin: auto;" /></p>
<p>Prepare the data for further analysis and check the resulting data frame.</p>
<pre class="r"><code>params &lt;- colnames(parameters[, names(parameters) != &quot;model&quot;])
AUROC_data &lt;-
  separate(AUROC_data, model, into =  params, sep = &quot;_&quot;)
# AUROC_data[AUROC_data$lw_rh == &quot;r+rh&quot;, &quot;lw_rh&quot;] &lt;- &quot;rainrh&quot;
AUROC_data[, 1:3] &lt;-
  lapply(AUROC_data[, 1:3], as.numeric)
data &lt;- data.frame(AUROC_data)
head(data) %&gt;% gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pmfgmlfvox .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#pmfgmlfvox .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#pmfgmlfvox .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pmfgmlfvox .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pmfgmlfvox .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#pmfgmlfvox .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#pmfgmlfvox .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#pmfgmlfvox .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#pmfgmlfvox .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#pmfgmlfvox .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#pmfgmlfvox .gt_striped {
  background-color: #f2f2f2;
}

#pmfgmlfvox .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#pmfgmlfvox .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#pmfgmlfvox .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#pmfgmlfvox .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#pmfgmlfvox .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#pmfgmlfvox .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#pmfgmlfvox .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#pmfgmlfvox .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#pmfgmlfvox .gt_center {
  text-align: center;
}

#pmfgmlfvox .gt_left {
  text-align: left;
}

#pmfgmlfvox .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pmfgmlfvox .gt_font_normal {
  font-weight: normal;
}

#pmfgmlfvox .gt_font_bold {
  font-weight: bold;
}

#pmfgmlfvox .gt_font_italic {
  font-style: italic;
}

#pmfgmlfvox .gt_super {
  font-size: 65%;
}

#pmfgmlfvox .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="pmfgmlfvox" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>rh_thresh</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>temp_thresh</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>hours</th>
<th class='gt_col_heading gt_left' rowspan='1' colspan='1'>lw_rh</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>auc</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_right'>87</td>
<td class='gt_row gt_right'>10</td>
<td class='gt_row gt_right'>10</td>
<td class='gt_row gt_left'>rain</td>
<td class='gt_row gt_right'>0.8064433</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>87</td>
<td class='gt_row gt_right gt_striped'>10</td>
<td class='gt_row gt_right gt_striped'>10</td>
<td class='gt_row gt_left gt_striped'>rainrh</td>
<td class='gt_row gt_right gt_striped'>0.7966495</td>
</tr>
<tr>
<td class='gt_row gt_right'>87</td>
<td class='gt_row gt_right'>10</td>
<td class='gt_row gt_right'>11</td>
<td class='gt_row gt_left'>rain</td>
<td class='gt_row gt_right'>0.7680412</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>87</td>
<td class='gt_row gt_right gt_striped'>10</td>
<td class='gt_row gt_right gt_striped'>11</td>
<td class='gt_row gt_left gt_striped'>rainrh</td>
<td class='gt_row gt_right gt_striped'>0.7997423</td>
</tr>
<tr>
<td class='gt_row gt_right'>87</td>
<td class='gt_row gt_right'>10</td>
<td class='gt_row gt_right'>12</td>
<td class='gt_row gt_left'>rain</td>
<td class='gt_row gt_right'>0.7128866</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>87</td>
<td class='gt_row gt_right gt_striped'>10</td>
<td class='gt_row gt_right gt_striped'>12</td>
<td class='gt_row gt_left gt_striped'>rainrh</td>
<td class='gt_row gt_right gt_striped'>0.7997423</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
</div>
</div>
<div id="parameter-evaluation" class="section level1">
<h1>Parameter evaluation</h1>
<div id="leaf-wetness-estimation" class="section level2">
<h2>Leaf wetness estimation</h2>
<p>Differences between pairs of models with same parameters, differing only in leaf wetness estimation. We shall consult visual aids to assess if distribution of differences follows normal distribution.</p>
<pre class="r"><code>t_data &lt;-
  data %&gt;%
  group_by(rh_thresh, temp_thresh, hours) %&gt;%
  unite(var, rh_thresh, temp_thresh, hours) %&gt;%
  spread(key = lw_rh, value = auc) %&gt;%
  mutate(difference = rain - rainrh)
ggplot(t_data, aes(x = difference)) +
  geom_density(fill = &quot;royalblue&quot;,
               alpha = 0.5,
               color = NA) +
  geom_point(aes(y = 0),
             alpha = 0.5) +
    geom_histogram(binwidth = 0.001) +
  theme_article()</code></pre>
<p><img src="images/leaf-wet-graphs-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Compute summary statistics by groups.</p>
<pre class="r"><code>group_by(data, lw_rh) %&gt;%
  summarise(
    count = n(),
    median = median(auc, na.rm = TRUE),
    IQR = IQR(auc, na.rm = TRUE)
  ) %&gt;% gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ccsysfnkrh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#ccsysfnkrh .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#ccsysfnkrh .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ccsysfnkrh .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ccsysfnkrh .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#ccsysfnkrh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#ccsysfnkrh .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#ccsysfnkrh .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#ccsysfnkrh .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#ccsysfnkrh .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#ccsysfnkrh .gt_striped {
  background-color: #f2f2f2;
}

#ccsysfnkrh .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#ccsysfnkrh .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#ccsysfnkrh .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#ccsysfnkrh .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#ccsysfnkrh .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#ccsysfnkrh .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#ccsysfnkrh .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#ccsysfnkrh .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#ccsysfnkrh .gt_center {
  text-align: center;
}

#ccsysfnkrh .gt_left {
  text-align: left;
}

#ccsysfnkrh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ccsysfnkrh .gt_font_normal {
  font-weight: normal;
}

#ccsysfnkrh .gt_font_bold {
  font-weight: bold;
}

#ccsysfnkrh .gt_font_italic {
  font-style: italic;
}

#ccsysfnkrh .gt_super {
  font-size: 65%;
}

#ccsysfnkrh .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ccsysfnkrh" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_left' rowspan='1' colspan='1'>lw_rh</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>count</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>median</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>IQR</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_left'>rain</td>
<td class='gt_row gt_right'>343</td>
<td class='gt_row gt_right'>0.6953608</td>
<td class='gt_row gt_right'>0.06018041</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>rainrh</td>
<td class='gt_row gt_right gt_striped'>343</td>
<td class='gt_row gt_right gt_striped'>0.7345361</td>
<td class='gt_row gt_right gt_striped'>0.09027062</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<pre class="r"><code>shapiro.test(t_data$difference)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  t_data$difference
## W = 0.8718, p-value = 2.877e-16</code></pre>
<p>The p-value &lt; 0.05 implying that the distribution of the data is significantly different from normal distribution. Use paired-sample Wilcoxon test to determine if median AUROC with r as lw estimator is as good as the median auc with both r and rh as estimators.</p>
<pre class="r"><code>w.test &lt;- with(t_data,
               wilcox.test(
                 rain,
                 rainrh,
                 paired = TRUE,
                 exact = F,
                 alternative = &quot;less&quot;
               ))
w.test</code></pre>
<pre><code>## 
##  Wilcoxon signed rank test with continuity correction
## 
## data:  rain and rainrh
## V = 11211, p-value &lt; 2.2e-16
## alternative hypothesis: true location shift is less than 0</code></pre>
<p>Wilcoxon signed rank test showed that median AUROC is greater when using both rain &gt;0.1 mm and RH&gt;90% instead only rain &gt;0.1 mm and as leaf wetness indicators with p &lt; 0.001. Model outputs with rain as single predictor are removed from further analysis.</p>
<pre class="r"><code>plot &lt;- 
data %&gt;%
  mutate(Leaf_Wetness = factor(ifelse(
    lw_rh == &quot;rainrh&quot;, &quot;rain and rh&quot;, &quot;only rain&quot;
  ))) %&gt;%
  ggplot(aes(
    x = factor(lw_rh),
    y = auc,
    group = Leaf_Wetness
  )) +
  geom_boxplot(aes(colour = Leaf_Wetness), width = 0.4) +
  # geom_label(aes_string(x=1.5, y=height, label=paste(&quot;p =&quot;,w.test$p.value)), label.size =0.02 )+
  scale_color_discrete(name = &quot;Leaf Wetness&quot;,
                       labels = c(&quot;Rain&gt;0.01&quot;, &quot;Rain&gt;0.01 &amp; RH&gt;=90%&quot;)) +
  scale_x_discrete(breaks = c(0, 90),
                   labels = c(&quot;rain&quot;, &quot;rh and rain&quot;)) +
  xlab(&quot;Infection period switch&quot;) +
  ylab(&quot;AUROC&quot;) +
  theme_article() +
  coord_equal(10 / 1)
plot+ggsave(here(&quot;data&quot;, &quot;op_2007_16&quot;,&quot;results&quot;,&quot;LWswithc.png&quot;), width = 11, height = 11, units = &quot;cm&quot;)</code></pre>
<p><img src="images/plot_lw_estim-1.png" width="672" /></p>
<pre class="r"><code>#Remove the data containg only rain as estimator
data &lt;- subset(data, lw_rh == &quot;rainrh&quot;)
data$lw_rh &lt;- NULL</code></pre>
</div>
<div id="t-rh-and-sporulation-duration" class="section level2">
<h2>T, RH and Sporulation duration</h2>
<div id="initial-exploration" class="section level3">
<h3>Initial exploration</h3>
<p>Scatter plot matrix shows some relationships between y and other variables.</p>
<pre class="r"><code>GGally::ggpairs(data,
                lower = list(continuous = &quot;points&quot;),
                upper = list(continuous = &quot;cor&quot;))</code></pre>
<p><img src="images/interactions-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Increasing temperature threshold had positive, while reducing rh and duration of sporulation threshold had negative correlation with AUROC.</p>
<p>Take initial look at descriptive statistics and trend of AUROC response as a factor of each variable investigated.</p>
<pre class="r"><code>p1 &lt;-  
  data[order(data$hours), ] %&gt;%
  ggplot(., aes(factor(hours), auc)) +
  geom_boxplot(width = 0.4) +
  geom_jitter(
    position = position_jitter(width = 0.2),
    colour = &quot;black&quot;,
    alpha = 0.6,
    size = 0.7
  ) +
  ggtitle(&quot;Durations of sporulation period&quot;) +
  geom_smooth(method = &quot;loess&quot;,
              se = T,
              color = &quot;red&quot;,
              aes(group = 1)) +
  xlab(&quot;Sporulation period (hours)&quot;) +
  ylab(&quot;AUROC&quot;) +
  theme_article()

p2 &lt;- 
  ggplot(data, aes(factor(rh_thresh), auc)) +
  geom_boxplot(width = 0.4) +
  geom_jitter(
    position = position_jitter(width = 0.2),
    colour = &quot;black&quot;,
    alpha = 0.6,
    size = 0.7
  ) +
  ggtitle(&quot;RH thresholds for sporulation and infection&quot;) +
  geom_smooth(method = &quot;loess&quot;,
              se = T,
              color = &quot;blue&quot;,
              aes(group = 1)) +
  ylab(&quot;AUROC&quot;) +
  xlab(&quot;RH threshold (%)&quot;) +
  theme_article()

p3 &lt;-  
  ggplot(data, aes(factor(temp_thresh), auc)) +
  geom_boxplot(width = 0.4) +
  geom_jitter(
    position = position_jitter(width = 0.2),
    colour = &quot;black&quot;,
    alpha = 0.6,
    size = 0.7
  ) +
  ggtitle(&quot;Temperature thresholds for sporulation and infection&quot;) +
  geom_smooth(
    method = &quot;loess&quot;,
    se = T,
    color = &quot;black&quot;,
    aes(group = 1),
    show.legend = T
  ) +
  xlab(&quot;Temperature threshold (°C)&quot;) +
  ylab(&quot;AUROC&quot;) +
  theme_article()

png(filename = here(&quot;data&quot;, &quot;op_2007_16&quot;,&quot;results&quot;,&quot;init_vis.png&quot;),
    width = 400, height = 800,bg = &quot;white&quot;, res = NA, restoreConsole = TRUE)
egg::ggarrange(p1,p2,p3, ncol = 1)
dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>p1;p2;p3</code></pre>
<p><img src="images/desc_stat-1.png" width="576" style="display: block; margin: auto;" /><img src="images/desc_stat-2.png" width="576" style="display: block; margin: auto;" /><img src="images/desc_stat-3.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="model-fitting" class="section level3">
<h3>Model fitting</h3>
<pre class="r"><code>lapply(data[, 1:3], function(x)
  sort(unique(x)))</code></pre>
<pre><code>## $rh_thresh
## [1] 87 88 89 90 91 92 93
## 
## $temp_thresh
## [1]  7  8  9 10 11 12 13
## 
## $hours
## [1]  9 10 11 12 13 14 15</code></pre>
<p>Create coded data set. Seven levels of each variable are used.</p>
<pre class="r"><code>cd_data &lt;- coded.data(data, Tt ~  (temp_thresh - 10),
                      RHt ~ (rh_thresh - 90),
                      SDt ~ (hours - 12))
str(cd_data)</code></pre>
<pre><code>## Classes &#39;coded.data&#39; and &#39;data.frame&#39;:   343 obs. of  4 variables:
##  $ RHt: num  -3 -3 -3 -3 -3 -3 -3 -3 -3 -3 ...
##  $ Tt : num  0 0 0 0 0 0 0 1 1 1 ...
##  $ SDt: num  -2 -1 0 1 2 3 -3 -2 -1 0 ...
##  $ auc: num  0.797 0.8 0.8 0.805 0.761 ...
##  - attr(*, &quot;codings&quot;)=List of 3
##   ..$ Tt :Class &#39;formula&#39;  language Tt ~ (temp_thresh - 10)
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   ..$ RHt:Class &#39;formula&#39;  language RHt ~ (rh_thresh - 90)
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   ..$ SDt:Class &#39;formula&#39;  language SDt ~ (hours - 12)
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##  - attr(*, &quot;rsdes&quot;)=List of 2
##   ..$ primary: chr  &quot;Tt&quot; &quot;RHt&quot; &quot;SDt&quot;
##   ..$ call   : language coded.data(data = data, Tt ~ (temp_thresh - 10), RHt ~ (rh_thresh -      90), SDt ~ (hours - 12))</code></pre>
<pre class="r"><code>head(cd_data) %&gt;% kable()</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
RHt
</th>
<th style="text-align:right;">
Tt
</th>
<th style="text-align:right;">
SDt
</th>
<th style="text-align:right;">
auc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
-3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-2
</td>
<td style="text-align:right;">
0.7966495
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
-3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
0.7997423
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
-3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.7997423
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
-3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.8054124
</td>
</tr>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
-3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.7608247
</td>
</tr>
<tr>
<td style="text-align:left;">
12
</td>
<td style="text-align:right;">
-3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.6768041
</td>
</tr>
</tbody>
</table>
<p>Fit models of first to fourth order, and evaluate fits.</p>
<pre class="r"><code>poly_1_fit &lt;-  lm(auc ~ poly(RHt, SDt, Tt, degree = 1), data = cd_data)
poly_2_fit &lt;-  lm(auc ~ poly(RHt, SDt, Tt, degree = 2), data = cd_data)
poly_3_fit &lt;-  lm(auc ~ poly(RHt, SDt, Tt, degree = 3), data = cd_data)
poly_4_fit &lt;-  lm(auc ~ poly(RHt, SDt, Tt, degree = 4), data = cd_data)

compareLM(poly_1_fit,poly_2_fit,poly_3_fit,poly_4_fit)[[2]] %&gt;% 
  add_column( Order = 1:4, .before = 1) %&gt;% 
  gt() </code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xyuwttsylj .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#xyuwttsylj .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#xyuwttsylj .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xyuwttsylj .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xyuwttsylj .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#xyuwttsylj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#xyuwttsylj .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#xyuwttsylj .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#xyuwttsylj .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#xyuwttsylj .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#xyuwttsylj .gt_striped {
  background-color: #f2f2f2;
}

#xyuwttsylj .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#xyuwttsylj .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#xyuwttsylj .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#xyuwttsylj .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#xyuwttsylj .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#xyuwttsylj .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#xyuwttsylj .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#xyuwttsylj .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#xyuwttsylj .gt_center {
  text-align: center;
}

#xyuwttsylj .gt_left {
  text-align: left;
}

#xyuwttsylj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xyuwttsylj .gt_font_normal {
  font-weight: normal;
}

#xyuwttsylj .gt_font_bold {
  font-weight: bold;
}

#xyuwttsylj .gt_font_italic {
  font-style: italic;
}

#xyuwttsylj .gt_super {
  font-size: 65%;
}

#xyuwttsylj .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="xyuwttsylj" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Order</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Rank</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Df.res</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>AIC</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>AICc</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>BIC</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>R.squared</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Adj.R.sq</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>p.value</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Shapiro.W</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Shapiro.p</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_right'>1</td>
<td class='gt_row gt_right'>4</td>
<td class='gt_row gt_right'>339</td>
<td class='gt_row gt_right'>-1281</td>
<td class='gt_row gt_right'>-1281</td>
<td class='gt_row gt_right'>-1262</td>
<td class='gt_row gt_right'>0.6375</td>
<td class='gt_row gt_right'>0.6342</td>
<td class='gt_row gt_right'>2.419e-74</td>
<td class='gt_row gt_right'>0.9934</td>
<td class='gt_row gt_right'>0.13760</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>2</td>
<td class='gt_row gt_right gt_striped'>10</td>
<td class='gt_row gt_right gt_striped'>333</td>
<td class='gt_row gt_right gt_striped'>-1408</td>
<td class='gt_row gt_right gt_striped'>-1407</td>
<td class='gt_row gt_right gt_striped'>-1366</td>
<td class='gt_row gt_right gt_striped'>0.7581</td>
<td class='gt_row gt_right gt_striped'>0.7516</td>
<td class='gt_row gt_right gt_striped'>4.713e-97</td>
<td class='gt_row gt_right gt_striped'>0.9971</td>
<td class='gt_row gt_right gt_striped'>0.81390</td>
</tr>
<tr>
<td class='gt_row gt_right'>3</td>
<td class='gt_row gt_right'>20</td>
<td class='gt_row gt_right'>323</td>
<td class='gt_row gt_right'>-1580</td>
<td class='gt_row gt_right'>-1577</td>
<td class='gt_row gt_right'>-1499</td>
<td class='gt_row gt_right'>0.8617</td>
<td class='gt_row gt_right'>0.8535</td>
<td class='gt_row gt_right'>3.272e-126</td>
<td class='gt_row gt_right'>0.9963</td>
<td class='gt_row gt_right'>0.61070</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>4</td>
<td class='gt_row gt_right gt_striped'>35</td>
<td class='gt_row gt_right gt_striped'>308</td>
<td class='gt_row gt_right gt_striped'>-1601</td>
<td class='gt_row gt_right gt_striped'>-1593</td>
<td class='gt_row gt_right gt_striped'>-1463</td>
<td class='gt_row gt_right gt_striped'>0.8811</td>
<td class='gt_row gt_right gt_striped'>0.8680</td>
<td class='gt_row gt_right gt_striped'>5.837e-122</td>
<td class='gt_row gt_right gt_striped'>0.9908</td>
<td class='gt_row gt_right gt_striped'>0.03029</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<p>Cubic model seems to be the best fit for our purpose. We want to get the best possible fit to the data, to understand underlying relationships between variable thresholds of our model. Hence, our priority is increase in explanatory power, for which our main guide is adjusted R<sup>2</sup>, while the distriburion of residuals is still fulfilling the assumption of normality. Model of 4<sup>th</sup> order seems to provide very little gain in terms of fit Adj. R<sup>2</sup> comparing to 3<sup>rd</sup> order, and most importantly is not overfitting indicated by Wilks-Shapiro test for model of 4<sup>th</sup> order. Information crterions are indication high values for all fits because of structure of data set, and this information is disregarded because the model is used for interpretation of the data.</p>
<pre class="r"><code>library(pander)
panderOptions(&#39;round&#39;, 2)
panderOptions(&#39;keep.trailing.zeros&#39;, TRUE)
pander(poly_3_fit,add.significance.stars = T)</code></pre>
<table>
<caption>Fitting linear model: auc ~ poly(RHt, SDt, Tt, degree = 3)</caption>
<colgroup>
<col width="38%" />
<col width="13%" />
<col width="15%" />
<col width="11%" />
<col width="13%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">t value</th>
<th align="center">Pr(&gt;|t|)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">0.74</td>
<td align="center">0.00</td>
<td align="center">583.67</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.0.0</strong></td>
<td align="center">-0.60</td>
<td align="center">0.02</td>
<td align="center">-25.78</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)2.0.0</strong></td>
<td align="center">-0.22</td>
<td align="center">0.02</td>
<td align="center">-9.57</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)3.0.0</strong></td>
<td align="center">0.09</td>
<td align="center">0.02</td>
<td align="center">3.69</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.1.0</strong></td>
<td align="center">-0.60</td>
<td align="center">0.02</td>
<td align="center">-25.39</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.1.0</strong></td>
<td align="center">2.32</td>
<td align="center">0.43</td>
<td align="center">5.34</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)2.1.0</strong></td>
<td align="center">2.37</td>
<td align="center">0.43</td>
<td align="center">5.46</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.2.0</strong></td>
<td align="center">-0.16</td>
<td align="center">0.02</td>
<td align="center">-6.65</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.2.0</strong></td>
<td align="center">4.83</td>
<td align="center">0.43</td>
<td align="center">11.11</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.3.0</strong></td>
<td align="center">0.04</td>
<td align="center">0.02</td>
<td align="center">1.57</td>
<td align="center">0.12</td>
<td></td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.0.1</strong></td>
<td align="center">0.31</td>
<td align="center">0.02</td>
<td align="center">13.39</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.0.1</strong></td>
<td align="center">-2.92</td>
<td align="center">0.43</td>
<td align="center">-6.73</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)2.0.1</strong></td>
<td align="center">2.38</td>
<td align="center">0.43</td>
<td align="center">5.47</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.1.1</strong></td>
<td align="center">-3.60</td>
<td align="center">0.43</td>
<td align="center">-8.29</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.1.1</strong></td>
<td align="center">21.18</td>
<td align="center">8.05</td>
<td align="center">2.63</td>
<td align="center">0.01</td>
<td>* *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.2.1</strong></td>
<td align="center">0.37</td>
<td align="center">0.43</td>
<td align="center">0.86</td>
<td align="center">0.39</td>
<td></td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.0.2</strong></td>
<td align="center">-0.04</td>
<td align="center">0.02</td>
<td align="center">-1.87</td>
<td align="center">0.06</td>
<td></td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.0.2</strong></td>
<td align="center">0.46</td>
<td align="center">0.43</td>
<td align="center">1.07</td>
<td align="center">0.29</td>
<td></td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.1.2</strong></td>
<td align="center">-0.83</td>
<td align="center">0.43</td>
<td align="center">-1.92</td>
<td align="center">0.06</td>
<td></td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.0.3</strong></td>
<td align="center">-0.13</td>
<td align="center">0.02</td>
<td align="center">-5.47</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
</tbody>
</table>
<p>Evaluate model fit with diagnostic plot.</p>
<pre class="r"><code>poly_3_fit$studres &lt;- rstudent(poly_3_fit)
plot(poly_3_fit$studres, main=&quot;Residuals vs Order of data&quot;)
abline(h = 0, col = &quot;red&quot;)
hist(resid(poly_3_fit)) #distriburion of residuals should be approximately  normal</code></pre>
<p><img src="images/diag_plot-1.png" width="50%" /><img src="images/diag_plot-2.png" width="50%" /></p>
<p>Assumptions of normapity of residuals are fulfilled.</p>
<p>Extract the model formula. The code has been borrowed from <a href="https://stackoverflow.com/questions/50116648/how-do-i-convert-the-following-poly-output-to-a-function-useable-in-excel">this StackOverflow thread</a></p>
<pre class="r"><code>processPolyNames = function(coef){
  members = strsplit(mgsub::mgsub(coef,c(&quot;poly\\(&quot;,&quot;, degre.*&quot;),c(&quot;&quot;,&quot;&quot;)),&quot;, &quot;)[[1]]
  degree = as.numeric(strsplit(strsplit(coef,&quot;)&quot;)[[1]][2],&quot;\\.&quot;)[[1]])
  coef_out = &quot;&quot;
  for(d in seq_along(degree)){
    if(degree[d] == 0) next
    if(degree[d] == 1){
      if(coef_out == &quot;&quot;){
        coef_out = members[d]
      } else {
        coef_out = paste0(coef_out,&quot;*&quot;,members[d])
      }
    } else {
      if(coef_out == &quot;&quot;){
        coef_out = paste0(members[d],&quot;^&quot;,degree[d],&quot;^&quot;)
      } else {
        coef_out = paste0(coef_out,&quot;*&quot;,members[d],&quot;^&quot;,degree[d],&quot;^&quot;)
      }
    }
  }
  return(coef_out)
}

coefs = summary(poly_3_fit)$coef[,1]
prettyNames = lapply(names(coefs)[-1],processPolyNames)
prettyModel = &quot;&quot;
for(i in seq_along(coefs)){
  if(i == 1){
    prettyModel = paste0(prettyModel,round(coefs[i],2))
  } else {
    prettyModel = paste0(prettyModel,ifelse(coefs[i] &gt;= 0,&quot; + &quot;,&quot; &quot;),round(coefs[i],2),&quot;*&quot;,prettyNames[[i-1]])
  }
}
prettyModel &lt;-  paste(&quot;AUROC =&quot;, gsub(&quot;-&quot;, &quot;- &quot;, prettyModel))
cat(prettyModel);rm(processPolyNames,coefs,prettyNames)</code></pre>
<pre><code>## AUROC = 0.74 - 0.6*RHt - 0.22*RHt^2^ + 0.09*RHt^3^ - 0.6*SDt + 2.32*RHt*SDt + 2.37*RHt^2^*SDt - 0.16*SDt^2^ + 4.83*RHt*SDt^2^ + 0.04*SDt^3^ + 0.31*Tt - 2.92*RHt*Tt + 2.38*RHt^2^*Tt - 3.6*SDt*Tt + 21.18*RHt*SDt*Tt + 0.37*SDt^2^*Tt - 0.04*Tt^2^ + 0.46*RHt*Tt^2^ - 0.83*SDt*Tt^2^ - 0.13*Tt^3^</code></pre>
<p>AUROC = 0.74 - 0.6<em>RHt - 0.22</em>RHt<sup>2</sup> + 0.09<em>RHt<sup>3</sup> - 0.6</em>SDt + 2.32<em>RHt</em>SDt + 2.37<em>RHt<sup>2</sup></em>SDt - 0.16<em>SDt<sup>2</sup> + 4.83</em>RHt<em>SDt<sup>2</sup> + 0.04</em>SDt<sup>3</sup> + 0.31<em>Tt - 2.92</em>RHt<em>Tt + 2.38</em>RHt<sup>2</sup><em>Tt - 3.6</em>SDt<em>Tt + 21.18</em>RHt<em>SDt</em>Tt + 0.37<em>SDt<sup>2</sup></em>Tt - 0.04<em>Tt<sup>2</sup> + 0.46</em>RHt<em>Tt<sup>2</sup> - 0.83</em>SDt<em>Tt<sup>2</sup> - 0.13</em>Tt<sup>3</sup></p>
</div>
<div id="surface-plot-of-model-fits" class="section level3">
<h3>Surface plot of model fits</h3>
<p>Visualise fitted response surface.</p>
<pre class="r"><code>z_min &lt;- min(data$auc) - c(min(data$auc) * 0.02)
z_max &lt;- max(data$auc) + c(max(data$auc) * 0.02)

# use a viridis palette for usability
library(viridis)
color_var &lt;- plasma(256)

par(mar = c(1.5, 4.5, 3.5, 1.5),
    mfrow = c(3, 3),
    cex = 0.5)

par_cut &lt;- data.frame(
  Tt = c(rep(0, 6), -3, 0,+3),
  RHt = c(rep(0, 3), -3, 0,+3, rep(0, 3)),
  SDt = c(-3, 0,+3, rep(0, 6))
)

plot_ls &lt;- list()

for (i in seq(nrow(par_cut))) {
  persp(poly_3_fit,
        if (i &lt;= 3) {
          ~ RHt + Tt
        } else if (i %in% 4:6) {
          ~ SDt + Tt
        } else if (i &gt;= 7) {
          ~ SDt + RHt
        }
        ,
        at = data.frame(par_cut[i,]),
    zlab = &quot;\nAUROC&quot;,
    xlab = if (i &lt;= 3) {
          c(&quot;RHt (%)&quot;,&quot;Tt (°C)&quot;)
        } else if (i %in% 4:6) {
          c(&quot;SDt (hours)&quot;, &quot;Tt (°C)&quot;)
        } else if (i &gt;= 7) {
          c(&quot;SDt (hours)&quot;, &quot;RHt (%)&quot;)
        },
    col = color_var,
    zlim = c(z_min, z_max),
    theta = 37,
    phi = 10,
    border = &quot;grey15&quot;,
    lwd = 0.5,
    cex.main = 1.8,
    cex.axis = 1.06,
    cex.lab = 1.8,
    main = paste0(&quot;\n&quot;,letters[i],&quot;) &quot;, &quot;Response at &quot;, 
                  &quot;Tt = &quot;, par_cut[i,1] + 10,&quot;°C;&quot;,
                   &quot;\n&quot;,
                  &quot;RHt = &quot;, par_cut[i,2] + 90, &quot;%; &quot;,
                  &quot;SDt = &quot;, par_cut[i,3] +12, &quot; hours.&quot;
                  )
  )
}</code></pre>
<p><img src="figures/persp-1.png" width="960" /></p>
<p>Plots show relationship between variation in parameters of two variables with third variable fixed at three levels and response as AUROC. 3D surface plots indicate that reduced sporulation duration and relative humidity threshold improves accuracy of the model; while model versions with increased teperature threshold have better diagnostic performance.</p>
<p>Another way to present this data is with countour plots. We will plot contour plots corresponding to the above 3D surfaces</p>
<pre class="r"><code>par(
  mar = c(3, 4, 4, 2),
    mfrow = c(3, 1),
    cex.main = 1.2,
    cex.axis = 1.06,
    cex.lab = 1.1)
# c(5, 4, 4, 2)

contour(poly_3_fit, ~ Tt + RHt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt = -3 ))
# contour(poly_3_fit, ~ Tt + RHt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt = 0))
# contour(poly_3_fit, ~ Tt + RHt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt =  +3))

contour(poly_3_fit, ~ Tt + SDt, image=TRUE, at = data.frame(Tt = 0, RHt = -3, SDt = 0 ))
# contour(poly_3_fit, ~ Tt + SDt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt = 0 ))
# contour(poly_3_fit, ~ Tt + SDt, image=TRUE, at = data.frame(Tt = 0, RHt = 3, SDt = 0 ))

# contour(poly_3_fit, ~ SDt + RHt, image=TRUE, at = data.frame(Tt = -3, RHt = 0, SDt = 0 ))
# contour(poly_3_fit, ~ SDt + RHt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt = 0 ))
contour(poly_3_fit, ~ SDt + RHt, image=TRUE, at = data.frame(Tt = 3, RHt = 0, SDt = 0 ))</code></pre>
<p><img src="figures/countour-1.png" width="480" /></p>
</div>
<div id="further-investigation" class="section level3">
<h3>Further investigation</h3>
<p>Based on the sensitivity analysis followig model parametrisations were compared to the original parameters of Irish Rules and further analised:</p>
<pre class="r"><code># fig.width=5, fig.height=5,
# par(
#     mfrow = c(1, 4)
#   )

mod_list &lt;-  list(
                  ROC_data[[&quot;88_10_12_rainrh&quot;]],
                  ROC_data[[&quot;90_10_10_rainrh&quot;]],
                  ROC_data[[&quot;90_12_12_rainrh&quot;]],
                  ROC_data[[&quot;90_10_12_rain&quot;]],
                  ROC_data[[&quot;88_12_10_rainrh&quot;]],
                  ROC_data[[&quot;88_10_10_rainrh&quot;]])

pl &lt;- map2(mod_list, c(1:length(mod_list)), PlotROC)
cowplot::plot_grid(pl[[1]], 
                   pl[[2]], 
                   pl[[3]],
                   pl[[4]], 
                   pl[[5]], 
                   pl[[6]], 
                   ncol=3)</code></pre>
<p><img src="figures/further_analysis-1.png" width="1152" /></p>
<pre class="r"><code>ls_roc &lt;- lapply(mod_list[4:6], function(x) {
  df &lt;- x[rev(x$cut_point),]
  #append rows for plotting
  x &lt;- rep(NA, ncol(df))
  df &lt;- rbind(x, df)
  df[nrow(df) + 1,] &lt;- NA
  df$model &lt;- unique(df$model[!is.na(df$model)])
  df[1,c(&quot;sens&quot;,&quot;one_min_spec&quot;)] &lt;- 0
  df[nrow(df),c(&quot;sens&quot;,&quot;one_min_spec&quot;)] &lt;- 1
  #Condense labels for a single cutoff point
 df &lt;- 
  df %&gt;% 
  group_by(one_min_spec, sens, model) %&gt;% 
  summarise(cut_point = ifelse(all(is.na(cut_point)),
                               &quot;&quot;,
                               range(cut_point, na.rm = TRUE) %&gt;%
                                 unique() %&gt;%
                                 paste(collapse = &quot;-&quot;))) %&gt;%
  ungroup()
  return(df)
})
df &lt;- bind_rows(ls_roc)

rename(df, Model = model) %&gt;%
  ggplot(aes(
    one_min_spec,
    sens,
    group = Model,
    color = Model,
    label = cut_point
  )) +
  # geom_abline(intercept=0, slope = 1, color=&quot;black&quot;, linetype=&quot;dashed&quot;)+
  geom_point() +
  geom_text_repel(size = 2) +
  geom_path(colour = &quot;gray&quot;) +
  geom_line() +
  scale_y_continuous(limits = c(0, 1),
                     expand = c(0, 0),
                     name = &quot;Sensitivity&quot;) +
  scale_x_continuous(limits = c(0, 1),
                     expand = c(0, 0),
                     name = &quot;1- Specificity&quot;) +
  theme_minimal() +
  theme(
    text = element_text(size = 14),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(
      linetype = &quot;dashed&quot;,
      size = 0.1,
      fill = &quot;NA&quot;,
      colour = &quot;black&quot;
    ),
    legend.position = c(.95, .15),
    legend.justification = c(&quot;right&quot;, &quot;bottom&quot;),
    # legend.box.just = &quot;right&quot;,
    legend.margin = margin(6, 6, 6, 6)
  )+
  ggtitle(&quot;ROC for selected models&quot;)</code></pre>
<p><img src="figures/plot-ROC-figures-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>IR have failed to indicate any risk in 2 and the warning threshold of 12 hour was reached in only 4 years out of 10.</p>
<p>Packages used</p>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 17134)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United States.1252 
## [2] LC_CTYPE=English_United States.1252   
## [3] LC_MONETARY=English_United States.1252
## [4] LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.1252    
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] viridis_0.5.1     viridisLite_0.3.0 bindrcpp_0.2.2   
##  [4] gt_0.1.0          pander_0.6.3      here_0.1         
##  [7] mgsub_1.5.0       rcompanion_2.0.10 R.utils_2.7.0    
## [10] R.oo_1.22.0       R.methodsS3_1.7.1 GGally_1.4.0     
## [13] rsm_2.10          egg_0.4.2         gridExtra_2.3    
## [16] ggthemes_4.0.1    ggrepel_0.8.0     pbapply_1.3-4    
## [19] remotes_2.0.2     pracma_2.2.2      devtools_1.13.6  
## [22] padr_0.4.1        imputeTS_2.7      zoo_1.8-4        
## [25] knitr_1.21        data.table_1.11.8 readxl_1.2.0     
## [28] forcats_0.3.0     stringr_1.3.1     dplyr_0.7.8      
## [31] purrr_0.2.5       readr_1.3.1       tidyr_0.8.2      
## [34] tibble_1.4.2      ggplot2_3.1.0     tidyverse_1.2.1  
## 
## loaded via a namespace (and not attached):
##  [1] TH.data_1.0-9      colorspace_1.3-2   modeltools_0.2-22 
##  [4] rprojroot_1.3-2    estimability_1.3   rstudioapi_0.8    
##  [7] manipulate_1.0.1   mvtnorm_1.0-8      lubridate_1.7.4   
## [10] coin_1.2-2         xml2_1.2.0         codetools_0.2-15  
## [13] splines_3.5.1      jsonlite_1.6       broom_0.5.1       
## [16] compiler_3.5.1     httr_1.4.0         emmeans_1.3.1     
## [19] backports_1.1.3    assertthat_0.2.0   Matrix_1.2-14     
## [22] lazyeval_0.2.1     cli_1.0.1          htmltools_0.3.6   
## [25] tools_3.5.1        coda_0.19-2        gtable_0.2.0      
## [28] glue_1.3.0         reshape2_1.4.3     Rcpp_1.0.0        
## [31] cellranger_1.1.0   fracdiff_1.4-2     urca_1.3-0        
## [34] nlme_3.1-137       lmtest_0.9-36      timeDate_3043.102 
## [37] xfun_0.4           rvest_0.3.2        MASS_7.3-50       
## [40] scales_1.0.0       hms_0.4.2          sandwich_2.5-0    
## [43] expm_0.999-3       RColorBrewer_1.1-2 yaml_2.2.0        
## [46] quantmod_0.4-13    curl_3.2           memoise_1.1.0     
## [49] sass_0.1.0.9000    uroot_2.0-9        EMT_1.1           
## [52] reshape_0.8.8      stringi_1.2.4      highr_0.7         
## [55] tseries_0.10-46    nortest_1.0-4      checkmate_1.8.5   
## [58] TTR_0.23-4         boot_1.3-20        commonmark_1.7    
## [61] rlang_0.3.1        pkgconfig_2.0.2    evaluate_0.12     
## [64] lattice_0.20-35    bindr_0.1.1        labeling_0.3      
## [67] stinepack_1.4      cowplot_0.9.3      tidyselect_0.2.5  
## [70] plyr_1.8.4         magrittr_1.5       R6_2.3.0          
## [73] DescTools_0.99.26  generics_0.0.2     multcompView_0.1-7
## [76] multcomp_1.4-8     pillar_1.3.1       haven_2.0.0       
## [79] foreign_0.8-70     withr_2.1.2        xts_0.11-2        
## [82] survival_2.42-3    nnet_7.3-12        modelr_0.1.2      
## [85] crayon_1.3.4       rmarkdown_1.11.3   grid_3.5.1        
## [88] webshot_0.5.1      forecast_8.4       digest_0.6.18     
## [91] xtable_1.8-3       stats4_3.5.1       munsell_0.5.0     
## [94] kableExtra_1.0.1   quadprog_1.5-5</code></pre>
</div>
</div>
</div>



Copyright 2018 Mladen Čučak


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
