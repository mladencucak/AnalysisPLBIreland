<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Results1.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PLB DSS Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa fa fa-home"></span>
     
    About
  </a>
</li>
<li>
  <a href="data.html">
    <span class="fa fa fa fa-table"></span>
     
    Data
  </a>
</li>
<li>
  <a href="Analysis.html">
    <span class="fa fa fa fa-table"></span>
     
    Analysis
  </a>
</li>
<li>
  <a href="Results1.html">
    <span class="fa fa fa fa-table"></span>
     
    Results
  </a>
</li>
<li>
  <a href="FungicideTreatments.html">
    <span class="fa fa fa fa-table"></span>
     
    Usefulness
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mladencucak/AnalysisPLBIreland">
    <span class="fa fa-github-square"></span>
     
    source
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Evaluation of Irish Rules model</h1>

</div>


<div id="parameter-evaluation" class="section level1">
<h1>Parameter evaluation</h1>
<div id="libraries" class="section level2">
<h2>Libraries</h2>
<p>Packages needed for the analysis are loaded. If the libraries do not exist locally, they will be downloaded.</p>
<pre class="r"><code>list.of.packages &lt;-
  c(
    &quot;tidyverse&quot;,
    &quot;readxl&quot;,
    &quot;data.table&quot;,
    &quot;knitr&quot;,
    &quot;zoo&quot;,
    &quot;imputeTS&quot;,
    &quot;ggthemes&quot;,
    &quot;rcompanion&quot;,
    &quot;mgsub&quot;,
    &quot;R.utils&quot;,
    &quot;here&quot;,
    &quot;stringr&quot;,
    &quot;pander&quot;,
    &quot;egg&quot;,
    &quot;rsm&quot;,
    &quot;ggrepel&quot;,
    &quot;cowplot&quot;
  )

new.packages &lt;-
  list.of.packages[!(list.of.packages %in% installed.packages()[, &quot;Package&quot;])]

#Download packages that are not already present in the library
if (length(new.packages))install.packages(new.packages, force = TRUE, dependencies = TRUE)

if (&quot;gt&quot; %in% installed.packages() == FALSE)
  remotes::install_github(&quot;rstudio/gt&quot;)

list.of.packages &lt;- c(list.of.packages, &quot;gt&quot;)
packages_load &lt;-
  lapply(list.of.packages, require, character.only = TRUE)

#Print warning if there is a problem with installing/loading some of packages
if (any(as.numeric(packages_load) == 0)) {
  warning(paste(&quot;Package/s&quot;, paste(list.of.packages[packages_load != TRUE]), &quot;not loaded!&quot;))
} else {
  print(&quot;All packages were successfully loaded.&quot;)
}</code></pre>
<pre><code>## [1] &quot;All packages were successfully loaded.&quot;</code></pre>
<pre class="r"><code>rm(list.of.packages, new.packages, packages_load)</code></pre>
</div>
<div id="leaf-wetness-estimation" class="section level2">
<h2>Leaf wetness estimation</h2>
<p>Differences between pairs of models with same parameters, differing only in leaf wetness estimation. We shall consult visual aids to assess if distribution of differences follows normal distribution.</p>
<pre class="r"><code># load the data
load( file = here::here(&quot;data&quot;, &quot;op_2007_16&quot;,  &quot;data.RData&quot;))

t_data &lt;-
  data %&gt;%
  group_by(rh_thresh, temp_thresh, hours) %&gt;%
  unite(var, rh_thresh, temp_thresh, hours) %&gt;%
  spread(key = lw_rh, value = auc) %&gt;%
  mutate(difference = rain - rainrh)
ggplot(t_data, aes(x = difference)) +
  geom_density(fill = &quot;royalblue&quot;,
               alpha = 0.5,
               color = NA) +
  geom_point(aes(y = 0),
             alpha = 0.5) +
    geom_histogram(binwidth = 0.001) +
  theme_article()</code></pre>
<p><img src="images/leaf-wet-graphs-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Compute summary statistics by groups.</p>
<pre class="r"><code>group_by(data, lw_rh) %&gt;%
  summarise(
    count = n(),
    median = median(auc, na.rm = TRUE),
    IQR = IQR(auc, na.rm = TRUE)
  ) %&gt;% gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xvblydschm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#xvblydschm .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#xvblydschm .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xvblydschm .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xvblydschm .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#xvblydschm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#xvblydschm .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#xvblydschm .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#xvblydschm .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#xvblydschm .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#xvblydschm .gt_striped {
  background-color: #f2f2f2;
}

#xvblydschm .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#xvblydschm .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#xvblydschm .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#xvblydschm .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#xvblydschm .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#xvblydschm .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#xvblydschm .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#xvblydschm .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#xvblydschm .gt_center {
  text-align: center;
}

#xvblydschm .gt_left {
  text-align: left;
}

#xvblydschm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xvblydschm .gt_font_normal {
  font-weight: normal;
}

#xvblydschm .gt_font_bold {
  font-weight: bold;
}

#xvblydschm .gt_font_italic {
  font-style: italic;
}

#xvblydschm .gt_super {
  font-size: 65%;
}

#xvblydschm .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="xvblydschm" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_left' rowspan='1' colspan='1'>lw_rh</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>count</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>median</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>IQR</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_left'>rain</td>
<td class='gt_row gt_right'>343</td>
<td class='gt_row gt_right'>0.6953608</td>
<td class='gt_row gt_right'>0.06018041</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>rainrh</td>
<td class='gt_row gt_right gt_striped'>343</td>
<td class='gt_row gt_right gt_striped'>0.7345361</td>
<td class='gt_row gt_right gt_striped'>0.09027062</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<pre class="r"><code>shapiro.test(t_data$difference)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  t_data$difference
## W = 0.8718, p-value = 2.877e-16</code></pre>
<p>The p-value &lt; 0.05 implying that the distribution of the data is significantly different from normal distribution. Use paired-sample Wilcoxon test to determine if median AUROC with r as lw estimator is as good as the median auc with both r and rh as estimators.</p>
<pre class="r"><code>w.test &lt;- with(t_data,
               wilcox.test(
                 rain,
                 rainrh,
                 paired = TRUE,
                 exact = F,
                 alternative = &quot;less&quot;
               ))
w.test</code></pre>
<pre><code>## 
##  Wilcoxon signed rank test with continuity correction
## 
## data:  rain and rainrh
## V = 11211, p-value &lt; 2.2e-16
## alternative hypothesis: true location shift is less than 0</code></pre>
<p>Wilcoxon signed rank test showed that median AUROC is greater when using both rain &gt;0.1 mm and RH&gt;90% instead only rain &gt;0.1 mm and as leaf wetness indicators with p &lt; 0.001. Model outputs with rain as single predictor are removed from further analysis.</p>
<pre class="r"><code>plot &lt;- 
data %&gt;%
  mutate(Leaf_Wetness = factor(ifelse(
    lw_rh == &quot;rainrh&quot;, &quot;rain and rh&quot;, &quot;only rain&quot;
  ))) %&gt;%
  ggplot(aes(
    x = factor(lw_rh),
    y = auc,
    group = Leaf_Wetness
  )) +
  geom_boxplot(aes(colour = Leaf_Wetness), width = 0.4) +
  # geom_label(aes_string(x=1.5, y=height, label=paste(&quot;p =&quot;,w.test$p.value)), label.size =0.02 )+
  scale_color_discrete(name = &quot;Leaf Wetness&quot;,
                       labels = c(&quot;Rain&gt;0.01&quot;, &quot;Rain&gt;0.01 &amp; RH&gt;=90%&quot;)) +
  scale_x_discrete(breaks = c(0, 90),
                   labels = c(&quot;rain&quot;, &quot;rh and rain&quot;)) +
  xlab(&quot;Infection period switch&quot;) +
  ylab(&quot;AUROC&quot;) +
  theme_article() +
  coord_equal(10 / 1)
plot+ggsave(here::here(&quot;data&quot;, &quot;op_2007_16&quot;,&quot;results&quot;,&quot;LWswithc.png&quot;), width = 11, height = 11, units = &quot;cm&quot;)</code></pre>
<p><img src="images/plot_lw_estim-1.png" width="672" /></p>
<pre class="r"><code>#Remove the data containg only rain as estimator
# data &lt;- subset(data, lw_rh == &quot;rainrh&quot;)
# data$lw_rh &lt;- NULL</code></pre>
</div>
<div id="t-rh-and-sporulation-duration" class="section level2">
<h2>T, RH and Sporulation duration</h2>
<div id="initial-exploration" class="section level3">
<h3>Initial exploration</h3>
<p>Scatter plot matrix shows some relationships between y and other variables.</p>
<pre class="r"><code>GGally::ggpairs(data,
                lower = list(continuous = &quot;points&quot;),
                upper = list(continuous = &quot;cor&quot;))</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;GGally&#39;:
##   method from   
##   +.gg   ggplot2</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="images/interactions-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Increasing temperature threshold had positive, while reducing rh and duration of sporulation threshold had negative correlation with AUROC.</p>
<p>Take initial look at descriptive statistics and trend of AUROC response as a factor of each variable investigated.</p>
<pre class="r"><code>p1 &lt;-  
  data[order(data$hours), ] %&gt;%
  ggplot(., aes(factor(hours), auc)) +
  geom_boxplot(width = 0.4) +
  geom_jitter(
    position = position_jitter(width = 0.2),
    colour = &quot;black&quot;,
    alpha = 0.6,
    size = 0.7
  ) +
  ggtitle(&quot;Durations of sporulation period&quot;) +
  geom_smooth(method = &quot;loess&quot;,
              se = T,
              color = &quot;red&quot;,
              aes(group = 1)) +
  xlab(&quot;Sporulation period (hours)&quot;) +
  ylab(&quot;AUROC&quot;) +
  theme_article()

p2 &lt;- 
  ggplot(data, aes(factor(rh_thresh), auc)) +
  geom_boxplot(width = 0.4) +
  geom_jitter(
    position = position_jitter(width = 0.2),
    colour = &quot;black&quot;,
    alpha = 0.6,
    size = 0.7
  ) +
  ggtitle(&quot;RH thresholds for sporulation and infection&quot;) +
  geom_smooth(method = &quot;loess&quot;,
              se = T,
              color = &quot;blue&quot;,
              aes(group = 1)) +
  ylab(&quot;AUROC&quot;) +
  xlab(&quot;RH threshold (%)&quot;) +
  theme_article()

p3 &lt;-  
  ggplot(data, aes(factor(temp_thresh), auc)) +
  geom_boxplot(width = 0.4) +
  geom_jitter(
    position = position_jitter(width = 0.2),
    colour = &quot;black&quot;,
    alpha = 0.6,
    size = 0.7
  ) +
  ggtitle(&quot;Temperature thresholds for sporulation and infection&quot;) +
  geom_smooth(
    method = &quot;loess&quot;,
    se = T,
    color = &quot;black&quot;,
    aes(group = 1),
    show.legend = T
  ) +
  xlab(&quot;Temperature threshold (°C)&quot;) +
  ylab(&quot;AUROC&quot;) +
  theme_article()


grDevices::png(filename = here::here(&quot;data&quot;, &quot;op_2007_16&quot;,&quot;results&quot;,&quot;init_vis.png&quot;),
    width = 400, height = 800,bg = &quot;white&quot;, res = NA)
egg::ggarrange(p1,p2,p3, ncol = 1)
dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<pre class="r"><code>p1;p2;p3</code></pre>
<p><img src="images/desc_stat-1.png" width="576" style="display: block; margin: auto;" /><img src="images/desc_stat-2.png" width="576" style="display: block; margin: auto;" /><img src="images/desc_stat-3.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="model-fitting" class="section level3">
<h3>Model fitting</h3>
<pre class="r"><code>lapply(data[, 1:3], function(x)
  sort(unique(x)))</code></pre>
<pre><code>## $rh_thresh
## [1] 87 88 89 90 91 92 93
## 
## $temp_thresh
## [1]  7  8  9 10 11 12 13
## 
## $hours
## [1]  9 10 11 12 13 14 15</code></pre>
<p>Create coded data set. Seven levels of each variable are used.</p>
<pre class="r"><code>cd_data &lt;- coded.data(data, Tt ~  (temp_thresh - 10),
                      RHt ~ (rh_thresh - 90),
                      SDt ~ (hours - 12)
                      )
str(cd_data)</code></pre>
<pre><code>## Classes &#39;coded.data&#39; and &#39;data.frame&#39;:   686 obs. of  5 variables:
##  $ RHt  : num  -3 -3 -3 -3 -3 -3 -3 -3 -3 -3 ...
##  $ Tt   : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ SDt  : num  -2 -2 -1 -1 0 0 1 1 2 2 ...
##  $ lw_rh: chr  &quot;rain&quot; &quot;rainrh&quot; &quot;rain&quot; &quot;rainrh&quot; ...
##  $ auc  : num  0.806 0.797 0.768 0.8 0.713 ...
##  - attr(*, &quot;codings&quot;)=List of 3
##   ..$ Tt :Class &#39;formula&#39;  language Tt ~ (temp_thresh - 10)
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   ..$ RHt:Class &#39;formula&#39;  language RHt ~ (rh_thresh - 90)
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   ..$ SDt:Class &#39;formula&#39;  language SDt ~ (hours - 12)
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##  - attr(*, &quot;rsdes&quot;)=List of 2
##   ..$ primary: chr  &quot;Tt&quot; &quot;RHt&quot; &quot;SDt&quot;
##   ..$ call   : language coded.data(data = data, Tt ~ (temp_thresh - 10), RHt ~ (rh_thresh -      90), SDt ~ (hours - 12))</code></pre>
<pre class="r"><code>head(cd_data) %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">RHt</th>
<th align="right">Tt</th>
<th align="right">SDt</th>
<th align="left">lw_rh</th>
<th align="right">auc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-3</td>
<td align="right">0</td>
<td align="right">-2</td>
<td align="left">rain</td>
<td align="right">0.8064433</td>
</tr>
<tr class="even">
<td align="right">-3</td>
<td align="right">0</td>
<td align="right">-2</td>
<td align="left">rainrh</td>
<td align="right">0.7966495</td>
</tr>
<tr class="odd">
<td align="right">-3</td>
<td align="right">0</td>
<td align="right">-1</td>
<td align="left">rain</td>
<td align="right">0.7680412</td>
</tr>
<tr class="even">
<td align="right">-3</td>
<td align="right">0</td>
<td align="right">-1</td>
<td align="left">rainrh</td>
<td align="right">0.7997423</td>
</tr>
<tr class="odd">
<td align="right">-3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">rain</td>
<td align="right">0.7128866</td>
</tr>
<tr class="even">
<td align="right">-3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">rainrh</td>
<td align="right">0.7997423</td>
</tr>
</tbody>
</table>
<p>We may use non-parametric local regression (loess) to obtain predicted values for the 4-dimensnional response surface, using RHt, SDt, and Tt, and all 3- and 2-way interations as the predictors. We can then compare the extent of agreement between polynomial regressions and the loess regression to aid in choosing the degree of the polynomial regression, by using the concordance correlation coefficient (see Lin, 1989, (A concordance correlation coefficient to evaluate reproducibility, Biometrics 45:255–268).</p>
<pre class="r"><code>lo_fit1 &lt;- loess(auc ~ RHt * SDt * Tt, data = cd_data)
lo_pred &lt;- predict(lo_fit1)</code></pre>
<p>Fit models of first to fourth order, and evaluate fits.</p>
<pre class="r"><code>poly_1_fit &lt;-  lm(auc ~ poly(RHt, SDt, Tt, degree = 1), data = cd_data)
poly_2_fit &lt;-  lm(auc ~ poly(RHt, SDt, Tt, degree = 2), data = cd_data)
poly_3_fit &lt;-  lm(auc ~ poly(RHt, SDt, Tt, degree = 3), data = cd_data)
poly_4_fit &lt;-  lm(auc ~ poly(RHt, SDt, Tt, degree = 4), data = cd_data)

rcompanion::compareLM(poly_1_fit,poly_2_fit,poly_3_fit,poly_4_fit)[[2]] %&gt;% 
  add_column( Order = 1:4, .before = 1) %&gt;% 
  gt() </code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lhkltlhzov .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#lhkltlhzov .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#lhkltlhzov .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lhkltlhzov .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lhkltlhzov .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#lhkltlhzov .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#lhkltlhzov .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#lhkltlhzov .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#lhkltlhzov .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#lhkltlhzov .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#lhkltlhzov .gt_striped {
  background-color: #f2f2f2;
}

#lhkltlhzov .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#lhkltlhzov .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#lhkltlhzov .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#lhkltlhzov .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#lhkltlhzov .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#lhkltlhzov .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#lhkltlhzov .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#lhkltlhzov .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#lhkltlhzov .gt_center {
  text-align: center;
}

#lhkltlhzov .gt_left {
  text-align: left;
}

#lhkltlhzov .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lhkltlhzov .gt_font_normal {
  font-weight: normal;
}

#lhkltlhzov .gt_font_bold {
  font-weight: bold;
}

#lhkltlhzov .gt_font_italic {
  font-style: italic;
}

#lhkltlhzov .gt_super {
  font-size: 65%;
}

#lhkltlhzov .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="lhkltlhzov" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Order</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Rank</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Df.res</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>AIC</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>AICc</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>BIC</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>R.squared</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Adj.R.sq</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>p.value</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Shapiro.W</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Shapiro.p</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_right'>1</td>
<td class='gt_row gt_right'>4</td>
<td class='gt_row gt_right'>682</td>
<td class='gt_row gt_right'>-2472</td>
<td class='gt_row gt_right'>-2472</td>
<td class='gt_row gt_right'>-2449</td>
<td class='gt_row gt_right'>0.5443</td>
<td class='gt_row gt_right'>0.5423</td>
<td class='gt_row gt_right'>6.469e-116</td>
<td class='gt_row gt_right'>0.9969</td>
<td class='gt_row gt_right'>0.2010</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>2</td>
<td class='gt_row gt_right gt_striped'>10</td>
<td class='gt_row gt_right gt_striped'>676</td>
<td class='gt_row gt_right gt_striped'>-2683</td>
<td class='gt_row gt_right gt_striped'>-2682</td>
<td class='gt_row gt_right gt_striped'>-2633</td>
<td class='gt_row gt_right gt_striped'>0.6707</td>
<td class='gt_row gt_right gt_striped'>0.6663</td>
<td class='gt_row gt_right gt_striped'>1.423e-156</td>
<td class='gt_row gt_right gt_striped'>0.9963</td>
<td class='gt_row gt_right gt_striped'>0.1034</td>
</tr>
<tr>
<td class='gt_row gt_right'>3</td>
<td class='gt_row gt_right'>20</td>
<td class='gt_row gt_right'>666</td>
<td class='gt_row gt_right'>-2771</td>
<td class='gt_row gt_right'>-2770</td>
<td class='gt_row gt_right'>-2676</td>
<td class='gt_row gt_right'>0.7188</td>
<td class='gt_row gt_right'>0.7107</td>
<td class='gt_row gt_right'>5.516e-169</td>
<td class='gt_row gt_right'>0.9987</td>
<td class='gt_row gt_right'>0.8944</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>4</td>
<td class='gt_row gt_right gt_striped'>35</td>
<td class='gt_row gt_right gt_striped'>651</td>
<td class='gt_row gt_right gt_striped'>-2784</td>
<td class='gt_row gt_right gt_striped'>-2780</td>
<td class='gt_row gt_right gt_striped'>-2621</td>
<td class='gt_row gt_right gt_striped'>0.7358</td>
<td class='gt_row gt_right gt_striped'>0.7220</td>
<td class='gt_row gt_right gt_striped'>5.768e-164</td>
<td class='gt_row gt_right gt_striped'>0.9973</td>
<td class='gt_row gt_right gt_striped'>0.3237</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<p>Cubic model seems to be the best fit for our purpose. We want to get the best possible fit to the data, to understand underlying relationships between variable thresholds of our model. Hence, our priority is increase in explanatory power, for which our main guide is adjusted R<sup>2</sup>, while the distriburion of residuals is still fulfilling the assumption of normality. Model of 4<sup>th</sup> order seems to provide very little gain in terms of fit Adj. R<sup>2</sup> comparing to 3<sup>rd</sup> order, and most importantly is not overfitting indicated by Wilks-Shapiro test for model of 4<sup>th</sup> order. Information crterions are indication high values for all fits because of structure of data set, and this information is disregarded because the model is used for interpretation of the data.</p>
<p>Looking at the concordance between local regression (loess) and polynomial models, we have:</p>
<pre class="r"><code>library(DescTools)</code></pre>
<pre><code>## 
## Attaching package: &#39;DescTools&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:data.table&#39;:
## 
##     %like%</code></pre>
<pre class="r"><code>pred_cd_data &lt;- 
  data.frame(
    lo_pred,
    predict(poly_1_fit),
    predict(poly_2_fit),
    predict(poly_3_fit),
    predict(poly_4_fit)
  )
c1 &lt;- CCC(pred_cd_data$lo_pred, pred_cd_data$predict.poly_1_fit.)$rho
c2 &lt;- CCC(pred_cd_data$lo_pred, pred_cd_data$predict.poly_2_fit.)$rho
c3 &lt;- CCC(pred_cd_data$lo_pred, pred_cd_data$predict.poly_3_fit.)$rho
c4 &lt;- CCC(pred_cd_data$lo_pred, pred_cd_data$predict.poly_4_fit.)$rho

plot(c(c1$est,c2$est,c3$est,c4$est), ylim = c(.8,1), pch = 16, type = &quot;o&quot;,
     ylab = &quot;Concordance with local regression prediction&quot;,
     xlab = &quot;Polynomial degree&quot;, xaxt = &quot;n&quot;)
axis(1, 1:4, 1:4); abline(h = 1, lty = 3)
arrows(1:4, c(c1$lwr.ci,c2$lwr.ci,c3$lwr.ci,c4$lwr.ci),
       1:4, c(c1$upr.ci,c2$upr.ci,c3$upr.ci,c4$upr.ci),
       code = 3, length = .05, angle = 90)</code></pre>
<p><img src="images/concordance-1.png" width="672" /></p>
<p>This reinforces the choice of the polynomial model of degree 3, which yields predictions that agree the most with the local, non-parametric regression, and hence adequately reproduces the behaviour of the response surface.</p>
<pre class="r"><code>library(pander)
panderOptions(&#39;round&#39;, 2)
panderOptions(&#39;keep.trailing.zeros&#39;, TRUE)
pander(poly_3_fit,add.significance.stars = T)</code></pre>
<table>
<caption>Fitting linear model: auc ~ poly(RHt, SDt, Tt, degree = 3)</caption>
<colgroup>
<col width="37%" />
<col width="12%" />
<col width="15%" />
<col width="11%" />
<col width="12%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">t value</th>
<th align="center">Pr(&gt;|t|)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">0.72</td>
<td align="center">0.00</td>
<td align="center">600.59</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.0.0</strong></td>
<td align="center">-0.78</td>
<td align="center">0.03</td>
<td align="center">-24.54</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)2.0.0</strong></td>
<td align="center">-0.23</td>
<td align="center">0.03</td>
<td align="center">-7.33</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)3.0.0</strong></td>
<td align="center">0.14</td>
<td align="center">0.03</td>
<td align="center">4.44</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.1.0</strong></td>
<td align="center">-0.69</td>
<td align="center">0.03</td>
<td align="center">-21.97</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.1.0</strong></td>
<td align="center">8.86</td>
<td align="center">0.83</td>
<td align="center">10.71</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)2.1.0</strong></td>
<td align="center">3.00</td>
<td align="center">0.83</td>
<td align="center">3.62</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.2.0</strong></td>
<td align="center">-0.03</td>
<td align="center">0.03</td>
<td align="center">-0.90</td>
<td align="center">0.37</td>
<td></td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.2.0</strong></td>
<td align="center">3.38</td>
<td align="center">0.83</td>
<td align="center">4.08</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.3.0</strong></td>
<td align="center">0.05</td>
<td align="center">0.03</td>
<td align="center">1.68</td>
<td align="center">0.09</td>
<td></td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.0.1</strong></td>
<td align="center">0.45</td>
<td align="center">0.03</td>
<td align="center">14.28</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.0.1</strong></td>
<td align="center">-6.46</td>
<td align="center">0.83</td>
<td align="center">-7.80</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)2.0.1</strong></td>
<td align="center">3.43</td>
<td align="center">0.83</td>
<td align="center">4.14</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.1.1</strong></td>
<td align="center">-6.50</td>
<td align="center">0.83</td>
<td align="center">-7.85</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.1.1</strong></td>
<td align="center">78.62</td>
<td align="center">21.68</td>
<td align="center">3.63</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.2.1</strong></td>
<td align="center">-0.23</td>
<td align="center">0.83</td>
<td align="center">-0.28</td>
<td align="center">0.78</td>
<td></td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.0.2</strong></td>
<td align="center">-0.09</td>
<td align="center">0.03</td>
<td align="center">-2.76</td>
<td align="center">0.01</td>
<td>* *</td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)1.0.2</strong></td>
<td align="center">0.75</td>
<td align="center">0.83</td>
<td align="center">0.90</td>
<td align="center">0.37</td>
<td></td>
</tr>
<tr class="odd">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.1.2</strong></td>
<td align="center">-1.59</td>
<td align="center">0.83</td>
<td align="center">-1.92</td>
<td align="center">0.06</td>
<td></td>
</tr>
<tr class="even">
<td align="center"><strong>poly(RHt, SDt, Tt, degree = 3)0.0.3</strong></td>
<td align="center">-0.16</td>
<td align="center">0.03</td>
<td align="center">-5.16</td>
<td align="center">0.00</td>
<td>* * *</td>
</tr>
</tbody>
</table>
<p>Evaluate model fit with diagnostic plot.</p>
<pre class="r"><code>poly_3_fit$studres &lt;- rstudent(poly_3_fit)
plot(poly_3_fit$studres, main=&quot;Residuals vs Order of data&quot;)
abline(h = 0, col = &quot;red&quot;)
hist(resid(poly_3_fit)) #distriburion of residuals should be approximately  normal</code></pre>
<p><img src="images/diag_plot-1.png" width="50%" /><img src="images/diag_plot-2.png" width="50%" /></p>
<p>Assumptions of normality of residuals are fulfilled.</p>
<p>Extract the model formula. The code has been borrowed from <a href="https://stackoverflow.com/questions/50116648/how-do-i-convert-the-following-poly-output-to-a-function-useable-in-excel">this StackOverflow thread</a></p>
<pre class="r"><code>processPolyNames = function(coef){
  members = strsplit(mgsub::mgsub(coef,c(&quot;poly\\(&quot;,&quot;, degre.*&quot;),c(&quot;&quot;,&quot;&quot;)),&quot;, &quot;)[[1]]
  degree = as.numeric(strsplit(strsplit(coef,&quot;)&quot;)[[1]][2],&quot;\\.&quot;)[[1]])
  coef_out = &quot;&quot;
  for(d in seq_along(degree)){
    if(degree[d] == 0) next
    if(degree[d] == 1){
      if(coef_out == &quot;&quot;){
        coef_out = members[d]
      } else {
        coef_out = paste0(coef_out,&quot;*&quot;,members[d])
      }
    } else {
      if(coef_out == &quot;&quot;){
        coef_out = paste0(members[d],&quot;^&quot;,degree[d],&quot;^&quot;)
      } else {
        coef_out = paste0(coef_out,&quot;*&quot;,members[d],&quot;^&quot;,degree[d],&quot;^&quot;)
      }
    }
  }
  return(coef_out)
}

coefs = summary(poly_3_fit)$coef[,1]
prettyNames = lapply(names(coefs)[-1],processPolyNames)
prettyModel = &quot;&quot;
for(i in seq_along(coefs)){
  if(i == 1){
    prettyModel = paste0(prettyModel,round(coefs[i],2))
  } else {
    prettyModel = paste0(prettyModel,ifelse(coefs[i] &gt;= 0,&quot; + &quot;,&quot; &quot;),round(coefs[i],2),&quot;*&quot;,prettyNames[[i-1]])
  }
}
prettyModel &lt;-  paste(&quot;AUROC =&quot;, gsub(&quot;-&quot;, &quot;- &quot;, prettyModel))
cat(prettyModel);rm(processPolyNames,coefs,prettyNames)</code></pre>
<pre><code>## AUROC = 0.72 - 0.78*RHt - 0.23*RHt^2^ + 0.14*RHt^3^ - 0.69*SDt + 8.86*RHt*SDt + 3*RHt^2^*SDt - 0.03*SDt^2^ + 3.38*RHt*SDt^2^ + 0.05*SDt^3^ + 0.45*Tt - 6.46*RHt*Tt + 3.43*RHt^2^*Tt - 6.5*SDt*Tt + 78.62*RHt*SDt*Tt - 0.23*SDt^2^*Tt - 0.09*Tt^2^ + 0.75*RHt*Tt^2^ - 1.59*SDt*Tt^2^ - 0.16*Tt^3^</code></pre>
<p>AUROC = 0.72 - 0.78<em>RHt - 0.23</em>RHt<sup>2</sup> + 0.14<em>RHt<sup>3</sup> - 0.69</em>SDt + 8.86<em>RHt</em>SDt + 3<em>RHt<sup>2</sup></em>SDt - 0.03<em>SDt<sup>2</sup> + 3.38</em>RHt<em>SDt<sup>2</sup> + 0.05</em>SDt<sup>3</sup> + 0.45<em>Tt - 6.46</em>RHt<em>Tt + 3.43</em>RHt<sup>2</sup><em>Tt - 6.5</em>SDt<em>Tt + 78.62</em>RHt<em>SDt</em>Tt - 0.23<em>SDt<sup>2</sup></em>Tt - 0.09<em>Tt<sup>2</sup> + 0.75</em>RHt<em>Tt<sup>2</sup> - 1.59</em>SDt<em>Tt<sup>2</sup> - 0.16</em>Tt<sup>3</sup></p>
</div>
<div id="surface-plot-of-model-fits" class="section level3">
<h3>Surface plot of model fits</h3>
<p>Visualise fitted response surface.</p>
<pre class="r"><code>z_min &lt;- min(data$auc) - c(min(data$auc) * 0.02)
z_max &lt;- max(data$auc) + c(max(data$auc) * 0.02)

# use a viridis palette for usability
library(viridis)
color_var &lt;- plasma(256)

par(mar = c(1.5, 4.5, 3.5, 1.5),
    mfrow = c(3, 3),
    cex = 0.5)

par_cut &lt;- data.frame(
  Tt = c(rep(0, 6), -3, 0,+3),
  RHt = c(rep(0, 3), -3, 0,+3, rep(0, 3)),
  SDt = c(-3, 0,+3, rep(0, 6))
)

plot_ls &lt;- list()

for (i in seq(nrow(par_cut))) {
  persp(poly_3_fit,
        if (i &lt;= 3) {
          ~ RHt + Tt
        } else if (i %in% 4:6) {
          ~ SDt + Tt
        } else if (i &gt;= 7) {
          ~ SDt + RHt
        }
        ,
        at = data.frame(par_cut[i,]),
    zlab = &quot;\nAUROC&quot;,
    xlab = if (i &lt;= 3) {
          c(&quot;RHt (%)&quot;,&quot;Tt (°C)&quot;)
        } else if (i %in% 4:6) {
          c(&quot;SDt (hours)&quot;, &quot;Tt (°C)&quot;)
        } else if (i &gt;= 7) {
          c(&quot;SDt (hours)&quot;, &quot;RHt (%)&quot;)
        },
    col = color_var,
    zlim = c(z_min, z_max),
    theta = 37,
    phi = 10,
    border = &quot;grey15&quot;,
    lwd = 0.5,
    cex.main = 1.8,
    cex.axis = 1.06,
    cex.lab = 1.8,
    main = paste0(&quot;\n&quot;,letters[i],&quot;) &quot;, &quot;Response at &quot;, 
                  &quot;Tt = &quot;, par_cut[i,1] + 10,&quot;°C;&quot;,
                   &quot;\n&quot;,
                  &quot;RHt = &quot;, par_cut[i,2] + 90, &quot;%; &quot;,
                  &quot;SDt = &quot;, par_cut[i,3] +12, &quot; hours.&quot;
                  )
  )
}</code></pre>
<p><img src="figures/persp-1.png" width="960" /></p>
<p>Plots show relationship between variation in parameters of two variables with third variable fixed at three levels and response as AUROC. 3D surface plots indicate that reduced sporulation duration and relative humidity threshold improves accuracy of the model; while model versions with increased teperature threshold have better diagnostic performance.</p>
<p>Another way to present this data is with countour plots. We will plot contour plots corresponding to the above 3D surfaces</p>
<pre class="r"><code>par(
  mar = c(3, 4, 4, 2),
    mfrow = c(3, 1),
    cex.main = 1.2,
    cex.axis = 1.06,
    cex.lab = 1.1)
# c(5, 4, 4, 2)

contour(poly_3_fit, ~ Tt + RHt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt = -3 ))
# contour(poly_3_fit, ~ Tt + RHt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt = 0))
# contour(poly_3_fit, ~ Tt + RHt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt =  +3))

contour(poly_3_fit, ~ Tt + SDt, image=TRUE, at = data.frame(Tt = 0, RHt = -3, SDt = 0 ))
# contour(poly_3_fit, ~ Tt + SDt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt = 0 ))
# contour(poly_3_fit, ~ Tt + SDt, image=TRUE, at = data.frame(Tt = 0, RHt = 3, SDt = 0 ))

# contour(poly_3_fit, ~ SDt + RHt, image=TRUE, at = data.frame(Tt = -3, RHt = 0, SDt = 0 ))
# contour(poly_3_fit, ~ SDt + RHt, image=TRUE, at = data.frame(Tt = 0, RHt = 0, SDt = 0 ))
contour(poly_3_fit, ~ SDt + RHt, image=TRUE, at = data.frame(Tt = 3, RHt = 0, SDt = 0 ))</code></pre>
<p><img src="figures/countour-1.png" width="480" /></p>
</div>
<div id="further-investigation" class="section level3">
<h3>Further investigation</h3>
<p>Based on the sensitivity analysis followig model parametrisations were compared to the original parameters of Irish Rules and further analised:</p>
<pre class="r"><code># fig.width=5, fig.height=5,
# par(
#     mfrow = c(1, 4)
#   )
#Load function and the data
load( file = here::here(&quot;data&quot;, &quot;op_2007_16&quot;,  &quot;ROC_data.RData&quot;))
load( file = here::here(&quot;data&quot;, &quot;op_2007_16&quot;,  &quot;AUROC_data.RData&quot;))
load( file = here::here(&quot;data&quot;, &quot;op_2007_16&quot;,  &quot;PlotROC.RData&quot;))

mod_list &lt;-  list(
                  ROC_data[[&quot;88_10_12_rainrh&quot;]],
                  ROC_data[[&quot;90_10_10_rainrh&quot;]],
                  ROC_data[[&quot;90_12_12_rainrh&quot;]],
                  ROC_data[[&quot;90_10_12_rain&quot;]],
                  ROC_data[[&quot;88_12_10_rainrh&quot;]],
                  ROC_data[[&quot;88_10_10_rainrh&quot;]])

pl &lt;- map2(mod_list, c(1:length(mod_list)), PlotROC)
plot_grid(pl[[1]], 
          pl[[2]],
          pl[[3]],
          pl[[4]],
          pl[[5]], 
          pl[[6]],
          ncol=3)</code></pre>
<p><img src="figures/further_analysis-1.png" width="1152" /></p>
<pre class="r"><code>ls_roc &lt;- lapply(mod_list[4:6], function(x) {
  df &lt;- x[rev(x$cut_point),]
  #append rows for plotting
  x &lt;- rep(NA, ncol(df))
  df &lt;- rbind(x, df)
  df[nrow(df) + 1,] &lt;- NA
  df$model &lt;- unique(df$model[!is.na(df$model)])
  df[1,c(&quot;sens&quot;,&quot;one_min_spec&quot;)] &lt;- 0
  df[nrow(df),c(&quot;sens&quot;,&quot;one_min_spec&quot;)] &lt;- 1
  #Condense labels for a single cutoff point
 df &lt;- 
  df %&gt;% 
  group_by(one_min_spec, sens, model) %&gt;% 
  summarise(cut_point = ifelse(all(is.na(cut_point)),
                               &quot;&quot;,
                               range(cut_point, na.rm = TRUE) %&gt;%
                                 unique() %&gt;%
                                 paste(collapse = &quot;-&quot;))) %&gt;%
  ungroup()
  return(df)
})
df &lt;- bind_rows(ls_roc)

rename(df, Model = model) %&gt;%
  ggplot(aes(
    one_min_spec,
    sens,
    group = Model,
    color = Model,
    label = cut_point
  )) +
  # geom_abline(intercept=0, slope = 1, color=&quot;black&quot;, linetype=&quot;dashed&quot;)+
  geom_point() +
  geom_text_repel(size = 2) +
  geom_path(colour = &quot;gray&quot;) +
  geom_line() +
  scale_y_continuous(limits = c(0, 1),
                     expand = c(0, 0),
                     name = &quot;Sensitivity&quot;) +
  scale_x_continuous(limits = c(0, 1),
                     expand = c(0, 0),
                     name = &quot;1- Specificity&quot;) +
  theme_minimal() +
  theme(
    text = element_text(size = 14),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(
      linetype = &quot;dashed&quot;,
      size = 0.1,
      fill = &quot;NA&quot;,
      colour = &quot;black&quot;
    ),
    legend.position = c(.95, .15),
    legend.justification = c(&quot;right&quot;, &quot;bottom&quot;),
    # legend.box.just = &quot;right&quot;,
    legend.margin = margin(6, 6, 6, 6)
  )+
  ggtitle(&quot;ROC for selected models&quot;)</code></pre>
<p><img src="figures/plot-ROC-figures-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>IR have failed to indicate any risk in 2 and the warning threshold of 12 hour was reached in only 4 years out of 10.</p>
</div>
</div>
</div>



Copyright 2018 Mladen Čučak


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
